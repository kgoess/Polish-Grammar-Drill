<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--
Copyright (c) 2011 Kevin M. Goess

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<title>polish adjective agreement: subject-verb-object</title>

<script type="text/javascript" src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"></script>

<script type="text/javascript">

YUI().use('node', 'event-key', 'anim', 'substitute', function(Y) {

var adjectiveEndings = {
             //    m-p_+_a  m-inam    f      n
 // "nominative-s": [    ~y or i~     'a'    'e'
    "genitive-s":   [ 'ego',  'ego',  'ej', 'ego' ],
    "dative-s":     [ 'emu',  'emu',  'ej', 'emu' ],
    "accusative-s": [ 'ego',  '=nom', 'ą',  'e'   ],
            //      m-pers    m       f    n 
    "nominative-p": [ 'IRR',   '=nas', '=nas', '=nas'],
    "genitive-p":   [ '*ch',   '*ch',  '*ch',  '*ch'] ,
    "dative-p":     [ '*m',    '*m',   '*m',   '*m' ],
    "accusative-p": [ '=gen',  '=nom', '=nom', '=nom'  ]
};
    
var pronounData = [
 [ 1, 's', '',           'I', ''],
 [ 2, 's', '',           'you', ''],
 [ 3, 's', 'm',          'he', ''], //what about m-personal?
 [ 3, 's', 'f',          'she', ''],
 [ 3, 's', 'm-personal', 'you (formal, masc.)', 'pan'],
 [ 3, 's', 'f',          'you (formal, fem.)', 'pani'],
 [ 1, 'p', '',           'we'],
 [ 2, 'p', '',           'you all'],
 [ 3, 'p', '',           'they'   ]
 //[ 3, 'p',               'you all (formal, masc.)'],
 //[ 3, 'p',               'you all (formal, mixed.)'], ????
];
  

//http://en.wikibooks.org/wiki/Polish/Masculine_noun_declension
//http://en.wiktionary.org/wiki/chłopiec
//  eng sing     eng pl          nom_sing    nom_pl       gen_sing    gen_pl       acc_sing    acc_pl     
var nounData = [
 [ 'house',      'houses',       'dom',      'domy',      'domu',     'domów',     'dom',      'domy',      'm',          'no-agent' ], 
 [ 'cat',        'cats',         'kot',      'koty',      'kota',     'kotów',     'kota',     'koty',      'm-animate',  'agent' ], 
 [ 'table',      'tables',       'stół',     'stoły',     'stołu',    'stołów',    'stół',     'stoły',     'm',          'no-agent'  ], 
 [ 'store',      'stores',       'sklep',    'sklepy',    'sklepu',   'sklepów',   'sklep',    'sklepy',    'm',          'no-agent' ], 
 [ 'church',     'churches',     'kościół',  'kościoły',  'kościoła', 'kościołów', 'kościół',  'kościoły',  'm',          'no-agent' ], 
 [ 'car',        'cars',         'samochód', 'samochody', 'samochodu','samochodów','samochód', 'samochody', 'm',          'no-agent' ], 
 [ 'bicycle',    'bicycles',     'rower',    'rowery',    'roweru',   'rowerów',   'rower',    'rowery',    'm',          'no-agent' ],
 [ 'train',      'trains',       'pociąg',   'pociągi',   'pociągu',  'pociągów',  'pociąg',   'pociągi',   'm',          'no-agent' ],
 [ 'airplane',   'airplanes',    'samolot',  'samoloty',  'samolotu', 'samolotów', 'samolot',  'samoloty',  'm',          'no-agent' ], 
 [ 'clock',      'clocks',       'zegar',    'zegary',    'zegara',   'zegarów',   'zegar',    'zegary',    'm',          'no-agent' ],
 [ 'watch',      'watches',      'zegarek',  'zegarki',   'zegarka',  'zegarków',  'zegarek',  'zegarki',   'm',          'no-agent' ],
 [ 'room',       'rooms',        'pokój',    'pokoje',    'pokoju',   'pokojów',   'pokój',    'pokoje',    'm',          'no-agent' ],
 [ 'boy',        'boys',         'chłopiec', 'chłopcy',   'chłopca',  'chłopców',  'chłopca',  'chłopców',  'm-personal', 'i-agent' ], 
 [ 'pen',        'pens',         'długopis', 'długopisy', 'długopis', 'długopisów','długopis', 'długopisy', 'm',          'no-agent' ], 
 [ 'shoe',       'shoes',        'but',      'buty',      'buta',     'butów',     'but',      'buty',      'm',          'no-agent' ], 
 [ 'sandwich',   'sandwiches',   'kanapka',  'kanapki',   'kanapki',  'kanapek',   'kanapkę',  'kanapki',   'f',          'no-agent' ],
 [ 'toy',        'toys',         'zabawka',  'zabawki',   'zabawki',  'zabawek',   'zabawkę',  'zabawki',   'f',          'no-agent' ],
 [ 'bank',       'banks',        'bank',     'banki',     'banku',    'banków',    'bank',     'banki',     'm',          'no-agent' ], 
 [ 'ball',       'balls',        'piłka',    'piłki',     'piłki',    'piłek',     'piłkę',    'piłki',     'f',          'no-agent' ],
 [ 'key',        'keys',         'klucz',    'klucze',    'klucza',   'kluczy',    'klucz',    'klucze',    'm',          'no-agent' ], 
 [ 'plate',      'plates',       'talerz',   'talerze',   'talerza',  'talerzy',   'talerz',   'talerze',   'm',          'no-agent' ], 
 [ 'hat',        'hats',         'kapelusz', 'kapelusze', 'kapelusza','kapeluszy', 'kapelusz', 'kapelusze', 'm',          'no-agent' ], 
 [ 'horse',      'horses',       'koń',      'konie',     'konia',    'koni',      'konia',    'konie',     'm-animate',  'agent' ], 
 [ 'woman',      'women',        'kobieta',  'kobiety',   'kobiety',  'kobiet',    'kobietę',  'kobiety',   'f',          'i-agent' ], 
 [ 'school',     'schools',      'szkoła',   'szkoły',    'szkoły',   'szkół',     'szkołę',   'szkoły',    'f',          'no-agent' ], 
 [ 'sister',     'sisters',      'siostra',  'siostry',   'siostry',  'siostr',    'siostrę',  'siostry',   'f',          'i-agent' ], 
 [ 'wife',       'wives',        'żona',     'żony',      'żony',     'żon',       'żonę',     'żony',      'f',          'i-agent' ], 
 [ 'cloud',      'clouds',       'chmura',   'chmury',    'chmury',   'chmur',     'chmurę',   'chmury',    'f',          'no-agent' ], 
 [ 'fish',       'fishes',       'ryba',     'ryby',      'ryby',     'ryb',       'rybę',     'ryby',      'f',          'agent' ], 
 [ 'bench',      'benches',      'ławka',    'ławki',     'ławki',    'ławek',     'ławkę',    'ławki',     'f',          'no-agent' ], 
 [ 'book',       'books',        'książka',  'książki',   'książki',  'książek',   'książkę',  'książki',   'f',          'no-agent' ], 
 [ 'daughter',   'daughters',    'córka',    'córki',     'córki',    'córek',     'córkę',    'córki',     'f',          'i-agent' ], 
 [ 't-shirt',    't-shirts',      'koszulka', 'koszulki',  'koszulki', 'koszulek',  'koszulkę', 'koszulki',  'f',          'no-agent' ], 
 [ 'skirt',      'skirts',       'spódnica', 'spódnice',  'spódnicy', 'spódnic',   'spódnicę', 'spódnice',  'f',          'no-agent' ], 
 [ 'street',     'streets',      'ulica',    'ulice',     'ulicy',    'ulic',      'ulica',    'ulice',     'f',          'no-agent' ], 
 [ 'road',       'roads',        'droga',    'drogi',     'drogi',    'dróg',      'drogę',    'drogi',     'f',          'no-agent' ], 
 [ 'apple',      'apples',       'jabłko',   'jabłka',    'jabłka',   'jabłek',    'jabłko',   'jabłka',    'n',          'no-agent' ], 
 [ 'chair',      'chairs',       'krzesło',  'krzesła',   'krzesła',  'krzeseł',   'krzesło',  'krzesła',   'n',          'no-agent' ], 
 [ 'soap',       'soaps',        'mydło',    'mydła',     'mydła',    'mydeł',     'mydło',    'mydła',     'n',          'no-agent' ], 
 [ 'bed',        'beds',         'łóżko',    'łóżka',     'łóżka',    'łóżek',     'łóżko',    'łóżka',     'n',          'no-agent' ], 
 [ 'animal',     'animals',      'zwierzę',  'zwierzęta', 'zwierzęcia','zwierząt', 'zwierzę',  'zwierzęta', 'n',          'agent' ],
 [ 'father',     'fathers',      'ojciec',   'ojcowie',   'ojca',     'ojców',     'ojca',     'ojców',     'm-personal', 'i-agent' ],
 [ 'husband',    'husbands',     'mąż',      'mężowie',   'męża',     'mężów',     'męża',     'mężów',     'm-personal', 'i-agent' ],
 [ 'grandpa',    'grandpas',     'dziadek',  'dziadkowie','dziadka',  'dziadków',  'dziadka',  'dziadków',  'm-personal', 'i-agent' ],
 [ 'newspaper',  'newspapers',   'gazeta',   'gazety',    'gazety',   'gazet',     'gazetę',   'gazety',    'f',          'no-agent' ],
 [ 'letter',     'letters',      'list',     'listy',     'listu',    'listów',    'list',     'listy',     'm',          'no-agent' ],    
 [ 'dictionary', 'dictionaries', 'słownik',  'słowniki',  'słownika', 'słowników', 'słownik',  'słowniki',  'm',          'no-agent' ], 
 [ 'sign',       'signs',        'znak',     'znaki',     'znaku',    'znaków',    'znak',     'znaki',     'm',          'no-agent' ],
 [ 'egg',        'eggs',         'jajko',    'jajka',     'jajka',    'jajek',     'jajko',    'jajka',     'n',          'no-agent' ],
 [ 'carrot',     'carrots',      'marchew',  'marchwie',  'marchwi',  'marchwi',   'marchew',  'marchwie',  'f',          'no-agent' ],
 [ 'sausage',    'sausages',     'kiełbasa', 'kiełbasy',  'kiełbasy', 'kiełbas',   'kiełbasę', 'kiełbasy',  'f',          'no-agent' ],
 [ 'bridge',     'bridges',      'most',     'mosty',     'mostu',    'mostów',    'most',     'mosty',     'm',          'no-agent' ],
 [ 'friend',     'friends',      'przyjaciel','przyjaciele','przyjaciela','przyjaciół','przyjaciela','przyjaciół','m-personal',     'i-agent' ],
 [ 'cabbage',    'cabbages',     'kapusta',  'kapusty',   'kapusty',  'kapust',    'kapustę',  'kapusty',   'f',          'no-agent' ]
] ;


var adjectiveData = [
  //           m             f             n           m-pers-plural
 [ 'large',  'duży',       'duża',       'duże',       'dużi'       ], 
 [ 'small',  'mały',       'mała',       'małe',       'małi'       ], 
 [ 'good',   'dobry',      'dobra',      'dobre',      'dobrzy'     ], 
 [ 'bad',    'zły',        'zła',        'złe',        'zli'        ], 
 [ 'tasty',  'smaczny',    'smaczna',    'smaczne',    'smaczni'    ], 
 [ 'nasty',  'niesmaczny', 'niesmaczna', 'niesmaczne', 'niesmaczni' ], 
 [ 'clean',  'czysty',     'czysta',     'czyste',     'czyści'     ], 
 [ 'wet',    'mokry',      'mokra',      'mokre',      'mokrzy'     ], 
 [ 'dry',    'suchy',      'sucha',      'suche',      'susi'       ], 
 [ 'dirty',  'brudny',     'brudna',     'brudne',     'brudni'     ], 
 [ 'sick',   'chory',      'chora',      'chore',      'chorzy'     ], 
 [ 'tired',  'zmęczony',   'zmęczona',   'zmęczone',   'zmęczeni'   ], 
 [ 'hot',    'gorący',     'gorąca',     'gorące',     'gorący'     ], 
 [ 'cold',   'zimny',      'zimna',      'zimne',      'zimni'      ], 
 [ 'white',  'biały',      'biała',      'białe',      'biali'      ], 
 [ 'black',  'czarny',     'czarna',     'czarne',     'czarni'     ], 
 [ 'red',    'czerwony',   'czerwona',   'czerwone',   'czerwoni'   ], 
 [ 'yellow', 'żółty',      'żółta',      'żółte',      'żółci'      ], 
 [ 'blue',   'niebieski',  'niebieska',  'niebieskie', 'niebiescy'  ], 
 [ 'green',  'zielony',    'zielona',    'zielone',    'zieleni'    ],
 [ 'gray',   'szary',      'szara',      'szare',      'szarzy'     ],
 [ 'brown',  'brązowy',    'brązowa',    'brązowe',    'brązowi'    ],
 [ 'pink',   'różowy',     'różowa',     'różowe',     'różowi'     ],
 [ 'tall',   'wysoki',     'wysoka',     'wysokie',    'wysocy'     ], 
 [ 'long',   'długi',      'długa',      'długie',     'dłudzy'     ], 
 [ 'distant','daleki',     'daleka',     'dalekie',    'dalecy'     ], 
 [ 'near',   'bliski',     'bliska',     'bliskie',    'bliscy'     ], 
 [ 'fast',   'szybki',     'szybka',     'szybkie',    'szybcy'     ],
 [ 'new',    'nowy',       'nowa',       'nowe',       'nowi'       ],
 [ 'old',    'stary',      'stara',      'stare',      'starzy'     ],
 [ 'polish', 'polski',     'polska',     'polskie',    'polscy'     ], 
 [ 'short(low)', 'niski',  'niska',      'niskie',     'niscy'      ], 
 [ 'expensive', 'drogi',   'droga',      'drogie',     'drodzy'     ], 
 [ 'cheap',     'tani',    'tania',      'tanie',      'tani'       ]

// [ 'short(hair)', 'krótki', 'krótka', 'krótkie' ], 
 //[ 'heavy', 'ci
 //light lekka ...
 //powolne
];

var byćPast = {
    s: [ 'będę',     'będziesz',  'będzie' ],
    p: [ 'będziemy', 'będziecie', 'będą' ]
};

var verbData = [
    { infinitive: [ 'czytać', "to read" ],
      english_past: 'was reading',
      english_future: 'will be reading',
      transitive: true,
      ok_subjects: 'i-agent',
      objects: [ 'książka', 'gazeta', 'list', 'słownik', 'znak' 
      ],
      present_tense: {
        s: [ 'czytam', 'czytasz', 'czyta' ],
        p: [ 'czytamy', 'czytacie', 'czytają' ]
      },
      past_tense: {
        s: [ 'czytałem/czytałam', 'czytałeś/czytałaś', 'czytał/czytała/czytało' ],
        p: [ 'czytaliśmy/czytałyśmy', 'czytaliście/czytałyście', 'czytali/czytały' ]
      },
      future_tense: {
        s: [ 'czytał', 'czytała' ],
        p: [ 'czytali', 'czytały']
      }
    },

    { infinitive: [ 'jeść', "to eat" ],
      english_past: 'was eating',
      english_future: 'will be eating',
      transitive: true,
      ok_subjects: 'agent',
      objects: [ 'kanapka', 'jabłko', 'jajko', 'kiełbasa', 'marchew', 'kapusta' 
      ],
      present_tense: {
        s: [ 'jem', 'jesz', 'je' ],
        p: [ 'jemy', 'jecie', 'jedzą' ]
      },
      past_tense: {
        s: [ 'jadłem/jadłam', 'jadłeś/jadłaś', 'jadł/jadła/jadło' ],
        p: [ 'jedliśmy/jadłyśmy', 'jedliście/jadłysćie', 'jedli/jadły' ]
      }, 
      future_tense: {
        s: [ 'jadł', 'jadła'  ],
        p: [ 'jedli', 'jadły' ]
      }
    },

    { infinitive: [ 'lubić', 'to like' ],
      english_past: 'was liking',
      english_future: 'will be liking',
      transitive: true,
      ok_subjects: 'agent',
      objects: 'any',
      present_tense: {
        s: [ 'lubię', 'lubisz', 'lubi' ],
        p: [ 'lubimy', 'lubicie', 'lubią']
      },
      past_tense: {
        s: [ 'lubiłem/lubiłam', 'lubiłeś/lubiłaś', 'lubił/lubiła/lubiło' ],
        p: [ 'lubiliśmy/lubiłyśmy', 'lubiliście/lubiłyście', 'lubili/lubiły' ]
      },
      future_tense: {
        s: [ 'lubił', 'lubiła'  ],
        p: [ 'lubili', 'lubiły' ]
      }
    },
// apparently chcieć takes the genitive 
// http://www.polishforums.com/grammar-usage-18/adjective-endings-masculine-personal-51432/
//    { infinitive: [ 'chcieć', 'to want' ],
//      transitive: true,
//      ok_subjects: 'i-agent',
//      objects: 'any', 
//      present_tense: {
//        s: [ 'chcę', 'chcesz', 'chce' ],
//        p: [ 'chcemy', 'chcecie', 'chcą' ]
//      }
//    },

    { infinitive: ['biec', 'to run' ],
        english_past: 'was running',
        english_future: 'will be running',
       //http://en.wiktionary.org/wiki/biec see also http://en.wiktionary.org/wiki/biegać
       //The difference in the meaning is that biegać implies a repeated action whereas biec only a single/permanent one.
      transitive: false,
      ok_subjects: 'agent',
      present_tense: {
        s: [ 'biegnę', 'biegniesz', 'biegnie' ],
        p: [ 'biegniemy', 'biegniecie', 'biegną' ]
      },
      past_tense: {
        s: [ 'biegłem/biegłam', 'biegłeś/biegłaś', 'biegł/biegła/biegło' ],
        p: [ 'biegliśmy/biegłyśmy', 'biegliście/biegłyście', 'biegli/biegły' ]
      },
        
      future_tense: {
        s: [ 'biegł', 'biegła'  ],
        p: [ 'biegli', 'biegły' ]
      }
    },
    { infinitive: ['brać', 'to take' ],
      english_past: 'was taking',
      english_future: 'will be taking',
      transitive: true,
      ok_subjects: 'agent',
      objects: 'any',
      present_tense: {
        s: ['biorę', 'bierzesz', 'bierze' ],
        p: ['bierzemy', 'bierzecie', 'biorą' ]
      },
      past_tense: {
        s: [ 'brałem/brałam', 'brałeś/brałaś', 'brał/brała/brało' ],
        p: [ 'braliśmy/brałyśmy', 'braliście/brałyście', 'brali/brały' ]
      },
      future_tense: {
        s: [ 'brał', 'brała'  ],
        p: [ 'brali', 'brały' ]
      }
    },
//    { infinitive: ['potrzebować', 'to need' ],
//      english_past: 'was needing', 
//      english_future: 'will be needing',
//      transitive: true,
//      ok_subjects: 'i-agent',
//      objects: 'any',
//      present_tense: {
//        s: [ 'potrzebuję', 'potrzebujesz', 'potrzebuje' ],
//        p: [ 'potrzebujemy', 'potrzebujecie', 'potrzebują' ]
//      },
//      past_tense: {
//        s: [ 'potrzebowałem/potrzebowałam','potrzebowałeś/potrzebowałaś','potrzebował/potrzebowała' ],
//        p: [ 'potrzebowaliśmy/potrzebowałyśmy', 'potrzebowaliście/potrzebowałyście', 'potrzebowali/potrzebowały' ]
//      },
//      future_tense: {
//        s: [ 'potrzebował', 'potrzebowała'  ],
//        p: [ 'potrzebowali', 'potrzebowały' ] 
//      }
//    },
    { infinitive: ['wracać', 'to return' ],
      english_past: 'was returning', 
      english_future: 'will be returning',
      transitive: false,
      ok_subjects: 'agent',
      //objects: 'any',
      present_tense: {
        s: [ 'wracam', 'wracasz', 'wraca' ],
        p: [ 'wracamy', 'wracacie', 'wracają' ]
      },
      past_tense: {
        s: [ 'wracałem/wracałam','wracałeś/wracałaś','wracał/wracała' ],
        p: [ 'wracaliśmy/wracałyśmy', 'wracaliście/wracałyście', 'wracali/wracały' ]
      },
      future_tense: {
        s: [ 'wracał', 'wracała'  ],
        p: [ 'wracali', 'wracały' ] 
      }
    },
    { infinitive: ['mieć', 'to have' ],
      english_past: 'was having', 
      english_future: 'will be having',
      transitive: true,
      ok_subjects: 'agent',
      objects: 'any',
      present_tense: {
        s: [ 'mam', 'masz', 'ma' ],
        p: [ 'mamy', 'macie', 'mają' ]
      },
      past_tense: {
        s: [ 'miałem/miałam','miałeś/miałaś','miał/miała' ],
        p: [ 'mieliśmy/miałysmy', 'mieliście/miałyście', 'mieli/miały' ]
      },
      future_tense: {
        s: [ 'miał', 'miała'  ],
        p: [ 'mieli', 'miały' ] 
      }
    },
    { infinitive: ['widzieć', 'to see' ],
      english_past: 'was seeing', 
      english_future: 'will be seeing',
      transitive: true,
      ok_subjects: 'agent',
      objects: 'any',
      present_tense: {
        s: [ 'widzę', 'widzisz', 'widzi' ],
        p: [ 'widzimy', 'widzicie', 'widzą' ]
      },
      past_tense: {
        s: [ 'widzałem/widzałam','widzałeś/widzałaś','widział/widziała' ],
        p: [ 'widzieliśmy/widziełyśmy', 'widzieliście/widziełyscie', 'widzieli/widziały' ]
      },
      future_tense: {
        s: [ 'widział', 'widziała'  ],
        p: [ 'widzieli', 'widziały' ] 
      }
    }
];



/**
 * This is the controller class that drives the page, keeps track of the 
 * current sentence and checks the answer.
 * @class Tester
 */
function Tester(){
    this.nouns = [];
    this.pronouns = [];
    this.adjectives = [];
    this.verbs = [];
    this.agents = [];
    this.intelligentAgents = [];
    this.nounLookup = {};
    this.currentVerb  = null;
    this.currentTense = null;
    this.currentPerson = null;
    this.currentSubject = null;
    this.currentObject = null;
    this.subjectIsPronoun = false; // for the current sentence
    this.isNegated = false;
};


Tester.prototype.addNoun = function(noun){
    this.nouns.push(noun);
    var type = noun.agentType;  // agent, i-agent, no-agent
    if (type === "agent"){
        this.agents.push(noun);
    }else if (type === "i-agent"){
        this.agents.push(noun);
        this.intelligentAgents.push(noun);
    }
    this.nounLookup[ noun.nom_sing ] = noun;
};
Tester.prototype.addVerb = function(verb){
    this.verbs.push(verb);
};

Tester.prototype.askQuestion = function(){
    var verb, s, failsafe;
    if (this.currentVerb && this.currentVerb.pinned){
        verb = this.currentVerb;
    }else{
        verb = this.pickRandomActiveVerb();
    }

    if (this.currentSubject && this.currentSubject.pinned){
        s = this.currentSubject;
        failsafe = 0;
        while (s.agentType && s.agentType !== verb.subjectType && failsafe++ < 20){
            verb = this.verbs [ Math.floor(Math.random()*this.verbs.length) ];
        }
    }else{
        this.generateSubject(verb);
    }
    this.currentVerb = verb;

    this.generateSubjectAdjective();

    this.setNegation();

    if (verb.isTransitive){
        var okObjects = verb.okObjects;
        if (okObjects === 'any'){
            this.currentObject = this.nouns[ Math.floor( Math.random()*this.nouns.length ) ];
        }else{
            var okObjectKey = okObjects[ Math.floor( Math.random()*okObjects.length ) ];
            this.currentObject = this.nounLookup[ okObjectKey ];
            if (! this.currentObject){
                alert("couldn't find noun for '" + okObjectKey + "'");
            }
        }
        this.objectAdjective = this.generateObjectAdjective();
        this.objectNumber    = Math.floor( Math.random()*(2) +1 ) % 2 === 0 ? 'singular' : 'plural';
    }else{
        this.currentObject = null;
        this.objectAdjective = null;
        this.objectNumber = null;
    }

    this.currentTense = this.pickTense();

    
    var questionDiv = Y.one('#question');
    questionDiv.set('innerHTML', this.currentEnglishSentence());

    var outputDiv = Y.one('#output');
    outputDiv.set('innerHTML', '');

    var inputEl = Y.one('#input input');
    inputEl.focus();
    inputEl.set('value', '');

};

Tester.prototype.pickRandomActiveVerb = function(){
    var aVerb, activeVerbs;

    activeVerbs = [];

    // hmm, wonder how this will scale with more verbs...
    for (i in this.verbs){
        aVerb = this.verbs[i];
        checkboxEl = Y.one("#wordlist-checkbox-" + aVerb.wordId);
        if (checkboxEl.get('checked')){
            activeVerbs.push(aVerb);
        }
    }
    // ...if the user has unchecked all the boxes...
    if (activeVerbs.length === 0){
        activeVerbs = this.verbs;
    }

    aVerb = activeVerbs [ Math.floor(Math.random()*activeVerbs.length) ];

    return aVerb;
};


Tester.prototype.generateSubject = function(verb){
    var okSubjectType, okSubjects;


    if (this.doUsePronounSubject()){
        var pronoun = this.pronouns[ Math.floor(Math.random()*this.pronouns.length) ];
        this.currentSubject = pronoun;
        this.subjectNumber = pronoun.number === 's' ? 'singular' : 'plural';
        this.currentPerson = pronoun.person;
        this.subjectIsPronoun = true;
    }else{ //generateSubjectNumber will revert to 'singular' if nothing is checked
        this.subjectNumber = this.generateSubjectNumber();
        this.currentPerson = 3;
        okSubjectType = verb.subjectType;
        if (okSubjectType === 'i-agent'){
            okSubjects = this.intelligentAgents; 
        }else{
            okSubjects = this.agents;
        }
        okSubjects = this.filterActiveSubjects(okSubjects);
        this.currentSubject   = okSubjects[ Math.floor(Math.random()*okSubjects.length) ];
        this.subjectIsPronoun = false;
    }
};

Tester.prototype.filterActiveSubjects = function(okSubjects){
    var i, activeSubjects;

    activeSubjects = [];

    for (i in okSubjects){
        aNoun = okSubjects[i];
        checkboxEl = Y.one("#wordlist-checkbox-" + aNoun.wordId);
        if (checkboxEl.get('checked')){
            activeSubjects.push(aNoun);
        }
    }
    // ...if the user has unchecked all the boxes...
    if (activeSubjects.length === 0){
        activeSubjects = okSubjects;
    }

    return activeSubjects;
};

Tester.prototype.generateSubjectAdjective = function(){
    var subjectAdjectivesOk = document.settings["subject-adjectives"].checked;

    if (subjectAdjectivesOk){
        if (this.subjectIsPronoun){
            this.subjectAdjective = false;
        }else{
            this.subjectAdjective = this.pickAdjectiveForSubject();
        }
    }else{
        this.subjectAdjective = false;
    }
};

Tester.prototype.setNegation = function(){
    if (this.doUseNegation()){
        this.isNegated = true;
    }else{
        this.isNegated = false;
    }
}

// if set, make a third of the sentences negations
Tester.prototype.doUseNegation = function(){
    var negationSetting = '';
    var numButtons = document.settings["verbs-negation"].length;
    var i;
    for (i = 0; i < numButtons; ++ i){
        if (document.settings["verbs-negation"][i].checked){
            negationSetting = document.settings["verbs-negation"][i].value; //sometimes, always, never
        }
    }
    if (negationSetting === "always"){
        return true;
    }else if (negationSetting === "never"){
        return false;
    }else if (negationSetting === "sometimes"){
        return Math.floor( Math.random()*(3) +1 ) % 3 === 0 ? true : false;
    }else{
        return false;
    }
}

Tester.prototype.canUseRegularSubject = function(){
    var singularOk = document.settings["subject-singular"].checked;
    var pluralOk   = document.settings["subject-plural"].checked;

    return singularOk || pluralOk;
};


Tester.prototype.generateSubjectNumber = function(){
    var singularOk = document.settings["subject-singular"].checked;
    var pluralOk   = document.settings["subject-plural"].checked;

    if (singularOk && pluralOk){ 
        return Math.floor( Math.random()*(2) +1 ) % 2 === 0 ? 'singular' : 'plural';
    }else if (pluralOk){
        return 'plural';
    }else if (singularOk){
        return 'singular';
    }else{
        document.settings["subject-singular"].checked = 1;
        return 'singular';
    }
};

Tester.prototype.pickAdjectiveForSubject = function(){
    return this.adjectives[ Math.floor(Math.random()*this.adjectives.length) ];
};

Tester.prototype.generateObjectAdjective = function(){
   var objectAdjectivesOk = document.settings["object-adjectives"].checked;
    if (objectAdjectivesOk){
        return this.adjectives[ Math.floor(Math.random()*this.adjectives.length) ];
    }else{
        return null;
    }
};

Tester.prototype.doUsePronounSubject = function(){
    var pronounsOk = document.settings["subject-pronouns"].checked;
    if (pronounsOk){
        if (this.canUseRegularSubject()){
            return Math.floor(Math.random()*3) % 3 === 0;
        }else{
            return true;
        }
    }else{
        return false;
    }
};

Tester.prototype.checkAnswer = function(){
    var answer = Y.one('#input input').get('value');
    var praise;
    answer = answer.replace(/ +$/, '');
    answer = answer.replace(/^ +/, '');


    if (answer === this.currentPolishSentence({wrapInTooltipDivs: false})){
        Y.one('#output').set('innerHTML', this.currentPolishSentence({wrapInTooltipDivs: true}));
        Y.one('#input-element').setStyle("background-color", "#3CFF00");
        
        praise = this.generateRandomPraise();
        alert(praise);

        var anim = new Y.Anim(
            { node: '#input-element', 
              from: { backgroundColor: "#3CFF00" },
              to:  { backgroundColor:  "#FFFFFF" }
            } 
        ); 
        anim.run();
        this.addToHistory(answer);

    }else if (answer.charAt(0).toUpperCase() !== answer.charAt(0)){
        alert('Capitalization is important...');
    }else if (answer.charAt( answer.length-1 ) !== '.'){
        alert('Punctuation is important...');
    }else{
        alert('Nie, zła odpowiedź, spróbuj ponownie!');
        //alert(this.currentPolishSentence({wrapInTooltipDivs: false}));
    }
};

Tester.prototype.addToHistory = function(answer){
    var historyDiv = Y.one('.answer-history');
    historyDivItem = Y.Node.create('<div class="answer-history-item">' + answer + '</div>');
    historyDiv.prepend(historyDivItem);
}

Tester.prototype.generateRandomPraise = function(){
    var praises = [ 'Świetnie!', 'Dobrze!', 'Wszystko Dobrze!',
                    'Wszystko dobre, co się dobrze kończy', 
                    'Najświetniej!',
                    'Doskonale!'
                  ];
    
    var roll = Math.floor(Math.random()*praises.length);
    return praises[roll];
}

Tester.prototype.currentPolishSentence = function(args){
    var wrapInTooltipDivs = args.wrapInTooltipDivs;  //true/false

    var subject = this.currentSubject;
    var subjectAdjective = this.subjectAdjective;
    var tense = this.currentTense; //present, past, future, etc...
    var verbArgs = {
        tense:             this.currentTense, //present, past, future, etc...
        number:            null,   // s or p
        person:            this.currentPerson, //1, 2, 3
        gender:            this.currentSubject.getGender(),
        wrapInTooltipDivs: wrapInTooltipDivs,
        isNegated:         this.isNegated
    };
    var subjectStr, subjectAdjectiveStr, verbStr;
    if (this.subjectNumber === 'singular'){
        subjectStr = subject.makePolishStr({
            wrapInTooltipDivs: wrapInTooltipDivs,
            caseAccessor:      "nom_sing",
            isInitialWord:     (! subjectAdjective)
        });

        verbArgs.number = 's';
        verbArgs.isInitialWord = (! subjectStr);
        verbStr = this.currentPolishVerbStr(verbArgs);

        if (subjectAdjective){
            subjectAdjectiveStr = subjectAdjective.makePolishStr({
                caseMethodName:    "nominativeSingularForGender", 
                gender:            subject.getGender(),
                isInitialWord:     true,
                wrapInTooltipDivs: wrapInTooltipDivs
            }) + ' ';
        }else{
            subjectAdjectiveStr = '';
        }
        if (! subjectAdjectiveStr && ! subjectStr){
            verbStr = verbStr.charAt(0).toUpperCase() + verbStr.slice(1);
        }

    }else{
        subjectStr = subject.makePolishStr({
            wrapInTooltipDivs: wrapInTooltipDivs,
            caseAccessor:      "nom_pl",
            isInitialWord:     (! subjectAdjective)
        });

        verbArgs.number = 'p';
        verbArgs.isInitialWord = (! subjectStr);
        verbStr = this.currentPolishVerbStr(verbArgs);

        if (subjectAdjective){
            subjectAdjectiveStr =  subjectAdjective.makePolishStr({
                caseMethodName:    "nominativePluralForGender", 
                gender:            subject.getGender(),
                isInitialWord:     true,
                wrapInTooltipDivs: wrapInTooltipDivs
            }) + ' ';
        }else{
            subjectAdjectiveStr = '';
        }
    }

    var str = subjectAdjectiveStr + subjectStr + ' ' + verbStr;
    str = str.replace(/^ +/, '');


    if (this.currentObject){
        var object = this.currentObject;
        var objectAdjective = this.objectAdjective;
        var objectStr, objectAdjectiveStr;
        if (this.objectNumber === 'singular'){
            objectStr = object.makePolishStr({
                wrapInTooltipDivs: wrapInTooltipDivs,
                caseAccessor:      this.isNegated ? "gen_sing" : "acc_sing"
            });
            if (objectAdjective){
                objectAdjectiveStr =  objectAdjective.makePolishStr({
                    caseMethodName:    this.isNegated ? "genitiveSingularForGender" : "accusativeSingularForGender", 
                    gender:            object.getGender(),
                    isInitialWord:     false,
                    wrapInTooltipDivs: wrapInTooltipDivs
                });
            }else{
                objectAdjectiveStr = '';
            }
        }else{
            objectStr = object.makePolishStr({
                wrapInTooltipDivs: wrapInTooltipDivs,
                caseAccessor:      this.isNegated ? "gen_pl" : "acc_pl"
            });
            if (objectAdjective){
                objectAdjectiveStr =  objectAdjective.makePolishStr({
                    caseMethodName:    this.isNegated ? "genitivePluralForGender" : "accusativePluralForGender", 
                    gender:            object.getGender(),
                    isInitialWord:     false,
                    wrapInTooltipDivs: wrapInTooltipDivs
                });
            }else{
                objectAdjectiveStr = '';
            }
        }
        if (objectAdjectiveStr){
            objectAdjectiveStr = ' ' + objectAdjectiveStr ;
        }
        str = str + objectAdjectiveStr +  ' ' + objectStr;
    }
    str = str.replace(/ +$/, '') + '.';

    return str;
};

Tester.prototype.currentPolishVerbStr = function (verbArgs){
    var verbStr = '';
    var verb = this.currentVerb;
    switch(verbArgs.tense) {
        case 'present': 
            verbStr =  verb.presentTense[ verbArgs.number ][ verbArgs.person - 1 ];
            break;
        case 'past':
            verbStr = verb.getPastTense(verbArgs);
            break;
        case 'future':
            verbStr = verb.getFutureTense(verbArgs);
            break;
    }
    if (verbArgs.isInitialWord && ! verbArgs.isNegated){
        verbStr = verbStr.charAt(0).toUpperCase() + verbStr.slice(1);
    }

    if (verbArgs.wrapInTooltipDivs){
        verbStr = verb.wrapInTooltipDivs(verbStr);
    }

    if (verbArgs.isNegated){
        verbStr = 'nie ' + verbStr;
        if (verbArgs.isInitialWord){
            verbStr = verbStr.charAt(0).toUpperCase() + verbStr.slice(1);
        }
    }
            
    return verbStr;
};

Tester.prototype.pickTense = function(){
    var roll = null;
    var presentTenseOk = document.settings["verbs-present"].checked;
    var pastTenseOk    = document.settings["verbs-past"].checked;
    var futureTenseOk  = document.settings["verbs-future"].checked;

    if (! (presentTenseOk || pastTenseOk || futureTenseOk)){
        document.settings["verbs-present"].checked = 1;
        presentTenseOk = true;
    }

    var okTenses = [];
    if (presentTenseOk){
        okTenses.push('present');
    }
    if (pastTenseOk){
        okTenses.push('past');
    }
    if (futureTenseOk){
        okTenses.push('future');
    }
    
    roll = Math.floor(Math.random()*okTenses.length);
    return okTenses [ roll ];
};

Tester.prototype.giveHint = function() {

    var str = this.currentPolishSentence({wrapInTooltipDivs: false});

    var showEvery = 3;

    var outstr = '';
    var i;
    for (i = 0; i < str.length; ++i){
        var rand = Math.floor(Math.random()*showEvery);
        // do spaces by default
        if (str.charAt(i) === ' ' || str.charAt(i) === '.'){
            outstr = outstr + str.charAt(i);
        // and initial letters
        }else if (i == 0 || i > 0 && str.charAt(i-1) === ' '){
            outstr = outstr + str.charAt(i);
        // and final letters (but not the last one of the last word, just to be difficult)
        }else if ((i < str.length -1) && str.charAt(i+1) === ' '){
            outstr = outstr + str.charAt(i);
        }else{
            outstr = outstr + (rand % showEvery === 1 ? str.charAt(i) : '<span class="graydot">.</span>');
        }
    }
    Y.one('#output').set('innerHTML', outstr);
};

Tester.prototype.showAnswer = function(){
    var str = this.currentPolishSentence({wrapInTooltipDivs: true});

    Y.one('#output').set('innerHTML', str);

};

Tester.prototype.showImagesIsChecked = function(){

    var tmpValue;
    Y.all('.radio-show-google-images').each(function(node) {
        if (node.get('checked')) tmpValue = node.get('value');
    });
    return tmpValue;
};

Tester.prototype.showHideWordList = function(buttonEl){

    var elId = buttonEl.get('id');

    var listEl = Y.one('#' + elId + '-list');
    if (listEl.hasClass('hidden')){
        listEl.removeClass('hidden');
    }else{
        listEl.addClass('hidden');
    }
};
    
Tester.prototype.currentEnglishSentence = function(){
    var s = '';
    var subjectNoun = '';

    if (this.subjectAdjective){
        s = this.subjectAdjective.english + ' ';
    }
    if (this.subjectNumber === 'singular'){
        subjectNoun = this.currentSubject.english_sing;
    }else{
        subjectNoun = this.currentSubject.english_pl;
    }
    if (! this.currentSubject.constructor.toString().match(/Pronoun/)){
        s = 'The ' + s;
    }
    s = s + this.currentSubject.wrapInPushpinDivs(subjectNoun, 'subject');

    s = s + ' + ' + this.currentVerb.wrapInPushpinDivs(this.getEnglishVerb(), 'verb') ;

    if (this.currentObject){
        if (this.objectNumber === 'singular'){
            s = s + ' + the ' + this.getObjectAdjectiveEnglishStr() + ' ' + this.currentObject.english_sing + '.';
        }else{
            s = s + ' + the ' + this.getObjectAdjectiveEnglishStr() + ' ' + this.currentObject.english_pl + '.';
        }
    }
    s = s.charAt(0).toUpperCase() + s.slice(1);

    return s;
};


// this looks funny being a method on Tester, it seems like it should be a method on Verb, but
// all the information it needs is in the Tester object
Tester.prototype.getEnglishVerb = function(){
    var englishVerbStr = '';
    switch (this.currentTense){
        case 'present':
            englishVerbStr = this.currentVerb.infinitive[1];
            break;
        case 'past':
            switch (this.subjectNumber){
                case 'singular':
                    englishVerbStr = this.currentVerb.getEnglishPast('singular', this.currentPerson);
                    break;
                case 'plural':
                    englishVerbStr = this.currentVerb.getEnglishPast('plural', this.currentPerson);
                    break;
                default:
                    alert("I don't know this subjectNumber " + this.subjectNumber + " for subject " + this.currentSubject);
            }
            break;
        case 'future':
            englishVerbStr = this.currentVerb.englishFuture;
            break;
        default:
            alert("I don't know this tense: " + this.currentTense);
    }
    if (this.isNegated){
        englishVerbStr = englishVerbStr.replace(/^(\S+)\s+/, '$1 not ');
    }
    return englishVerbStr;
};

Tester.prototype.getObjectAdjectiveEnglishStr = function(){
    if (this.objectAdjective){
        return this.objectAdjective.english;
    }else{
        return '';
    }

};

Tester.prototype.generateGoogleUrl = function() {
    var s = escape(this.currentEnglishSentence());

    return 'http://images.google.com/search?safe=on&tbm=isch&q=' + s;
};

Tester.prototype.pushpinPushed = function(pushpinSpanEl){

    var elId = pushpinSpanEl.get('id'); //e.g answer-word-verb-pushpin-setter
    var matched = elId.match(/question-word-(.+?)-pushpin/);
    var partOfSentence = matched[1]; //subject, verb, object, subject-adjective, object-adjective

    if (pushpinSpanEl.hasClass('pushpin-on')){
        this.unsetPushpin(pushpinSpanEl, partOfSentence);
    }else{
        this.setPushpin(pushpinSpanEl, partOfSentence);
    }
};

Tester.prototype.setPushpin = function(pushpinSpanEl, partOfSentence){

    var pushpinImgEl = pushpinSpanEl.one('img');

    pushpinSpanEl.removeClass('pushpin-hidden');
    pushpinSpanEl.removeClass('pushpin-off');
    pushpinSpanEl.addClass('pushpin-on');
    pushpinImgEl.set('src', 'push_pin-on.png');

    switch (partOfSentence){
        case 'verb':
            var verb = this.currentVerb;
            verb.pinned = true;
            break;
        case 'subject':
            var subject = this.currentSubject;
            subject.pinned = true;
            break;
        default:
            return;
    }
};
Tester.prototype.unsetPushpin = function(pushpinSpanEl, partOfSentence){
    var pushpinImgEl = pushpinSpanEl.one('img');

    pushpinImgEl.set('src', 'push_pin-off.png');
    // don't hide it right away, too abrupt, pushpinSpanEl.addClass('pushpin-hidden');

    switch (partOfSentence){
        case 'verb':
            var verb = this.currentVerb;
            verb.pinned = false;
            break;
        case 'subject':
            var subject = this.currentSubject;
            subject.pinned = false;
            break;
        default:
            return;
    }
};


Word.prototype.wrapInTooltipDivsTemplate = function (args){
    var str              = args.polishStr;
    var wikiLookup       = args.wikiLookup;
    var tooltipStr       = args.tooltipStr;

    var tooltipTemplate = this.tooltipTemplate;

    var stash = {
        polishStr: str,
        wikiLookup: wikiLookup,
        tooltipStr: tooltipStr
    }

    return Y.substitute(tooltipTemplate, stash);
}
Tester.prototype.checkboxWordListTemplate = '<input id="wordlist-checkbox-{wordId}" type="checkbox" checked="1"/>{english}</input><br/>';
Tester.prototype.populateCheckboxWordLists = function() {
    var i, row, word, template, stash, html;

    template = this.checkboxWordListTemplate;

    for (i in verbData){
        row = verbData[i];
        word = new Verb(row);
        stash = { 
            english: word.infinitive[1],
            wordId: word.wordId
        };
        html = Y.substitute(template, stash);
        el = Y.Node.create(html);

        sectionEl = Y.one('#verb-section-list');
        sectionEl.append(el);  
    }

    // the subjects (only agents or i-agents are subjects for verbs)
    for (i in nounData){
        row = nounData[i];
        word = new Noun(row);
        if (word.agentType === 'no-agent'){
            continue;
        }
        stash = {
            english: word.english_sing,
            wordId: word.wordId
        };
        html = Y.substitute(template, stash);
        el = Y.Node.create(html);

        sectionEl = Y.one('#subject-section-list');
        sectionEl.append(el);
    }
};

/**
 * This is the base class for Noun, Verb, Adjective, and Pronoun.
 * @class Word
 */    
function Word(){

}

// looking for :hover on span instead of a tag means IE6 isn't supported, oh well
Word.prototype.tooltipTemplate = '<span class="answer-word" >{polishStr}<span class="tooltip"><a href="http://en.wiktionary.org/wiki/{wikiLookup}#Polish" target="_blank">{tooltipStr}</a></span></span> ';

Word.prototype.wrapInTooltipDivsTemplate = function (args){
    var str              = args.polishStr;
    var wikiLookup       = args.wikiLookup;
    var tooltipStr       = args.tooltipStr;

    var tooltipTemplate = this.tooltipTemplate;

    var stash = {
        polishStr: str,
        wikiLookup: wikiLookup,
        tooltipStr: tooltipStr
    }

    return Y.substitute(tooltipTemplate, stash);
};

Word.prototype.pushpinTemplate = '<span class="question-word" id="question-word-{partOfSpeech}"><span class="pushpin {hiddenClass} {onOffClass}" id="question-word-{partOfSpeech}-pushpin"><img src="{imgSrc}"/></span>{englishStr}</span>';

Word.prototype.wrapInPushpinDivs = function(englishStr, partOfSpeech){

    var stash = {
        englishStr: englishStr,
        partOfSpeech: partOfSpeech,
        hiddenClass: (this.pinned ? '' : 'pushpin-hidden'),
        imgSrc: (this.pinned ? 'push_pin-on.png' : 'push_pin-off.png'),
        onOffClass: (this.pinned ? 'pushpin-on' : 'pushpin-off')
    };
        
    return Y.substitute(this.pushpinTemplate, stash);
};


/**
 * Can be the subject or the direct object
 * @class Noun
 */

function Noun(args){
    this.english_sing = args[0];
    this.english_pl   = args[1];
    this.nom_sing     = args[2];
    this.nom_pl       = args[3];
    this.gen_sing     = args[4];
    this.gen_pl       = args[5];
    this.acc_sing     = args[6];
    this.acc_pl       = args[7];
    this.gender       = args[8];
    this.agentType    = args[9];

    this.wordId = this.nom_sing; // like a primary key for all the words here
}
Y.extend(Noun, Word);

Noun.prototype.getGender = function(){
    return this.gender;
};
Noun.prototype.wrapInTooltipDivs = function(str){

    return this.wrapInTooltipDivsTemplate({
        polishStr: str,
        wikiLookup: this.nom_sing,
        tooltipStr: this.nom_sing+' '+this.gender+'.'
    });
} 

Noun.prototype.makePolishStr = function(args){
    var wrapInTooltipDivs = args.wrapInTooltipDivs; //true/false
    var caseAccessor      = args.caseAccessor; //e.g. "nom_sing"
    var isInitialWord     = args.isInitialWord;

    var nounStr = this[caseAccessor];

    if (isInitialWord){
        nounStr = nounStr.charAt(0).toUpperCase() + nounStr.slice(1);
    }

    if (wrapInTooltipDivs){
        nounStr = this.wrapInTooltipDivs(nounStr);
    }

    return nounStr;
};


/**
 * @class Pronoun
 */
function Pronoun(args){
    this.person = args[0];
    this.number = args[1];
    this.gender = args[2];
    this.english_sing= args[3];
    this.english_pl = args[3]; //cheating here so we can use both a noun and a pronoun, fix that
    this.nom_sing = args[4] || '';
    this.nom_pl = args[4] || '';
}
Y.extend(Pronoun, Word);

Pronoun.prototype.getGender = function(){
    var g = '';
    if ( this.person === 1 ){
        g = this.genderOfSpeaker();
    }else if ( this.person === 2 ){
        g = 'm-personal'; // do something better later
    }else if (this.gender){ // 3rd p singular
        g = this.gender;
    }else{
        g = 'm-personal';   // 3rd p plural, do something better later
    }
    return g;
};

Pronoun.prototype.genderOfSpeaker = function() {
    var nodeList =  document.settings["gender-of-speaker"];
    var i;
    for(i = 0; i < nodeList.length; i++) {
        if (nodeList.item(i).checked){
            g = nodeList.item(i).value;
        }
    }
    return g;
};

// we don't actually display the polish string for the pronouns, hmm, that's some side effect of something I think...?
Pronoun.prototype.wrapInTooltipDivs = function(str){
    return str;
};
Pronoun.prototype.makePolishStr = function(args){
    var caseMethodName     = args.caseMethodName; //e.g. "nominativeSingularForGender"
    var gender             = args.gender;
    var isInitialWord      = args.isInitialWord;

    var wrapInTooltipDivs = args.wrapInTooltipDivs; //true/false
    var caseAccessor = args.caseAccessor; //e.g. "nom_sing"

    var nounStr = this[caseAccessor];

    if (isInitialWord){
        nounStr = nounStr.charAt(0).toUpperCase() + nounStr.slice(1);
    }

    if (wrapInTooltipDivs){ //this is a no-op for pronouns
        nounStr = this.wrapInTooltipDivs(nounStr);
    }

    return nounStr;
};



/**
 * Can be attached to the subject or the direct object, or turned off on either/both of those
 * @class Adjective
 */
function Adjective(args){
    this.english   = args[0];
    this.m         = args[1];
    this.f         = args[2];
    this.n         = args[3];
    this.mPersMasc = args[4];

    this.wordId = this.m; // like a primary key for all the words here
}
Y.extend(Adjective, Word);

Adjective.prototype.adjectiveEndings = adjectiveEndings;
Adjective.prototype.nominativeSingularForGender = function (gender){
    switch(gender) {
        case 'f': 
            return this.f;
        case 'n':
            return this.n;
        case 'm':
        case 'm-animate':
        case 'm-personal':
            return this.m;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
};
Adjective.prototype.nominativePluralForGender = function (gender){

    var result = '';
    
    switch(gender) {
        case 'f': 
        case 'n':
        case 'm':
        case 'm-animate':
            result = this.n;
            break;
        case 'm-personal':
            result = this.mPersMasc;
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result;
};
Adjective.prototype.genitiveSingularForGender = function (gender){
    var stem = this.stem();
    var masculineEnding = this.masculineEnding(); // "i" or "y"
    var endings = this.adjectiveEndings['genitive-s'];
    var result = '';
    switch(gender) {
        case 'f': 
            result = this.addEndingToStemSingular(endings[2]);
            break;
        case 'n':
            result = this.addEndingToStemSingular(endings[3]);
            break;
        case 'm':
        case 'm-animate':
        case 'm-personal':
            result = this.addEndingToStemSingular(endings[0]);
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result;
};
Adjective.prototype.addEndingToStemSingular = function (ending){
    var stem = this.stem(),
        result;
    if (stem.charAt(stem.length-1)=='k' ||
        stem.charAt(stem.length-1)=='g'){
        result = stem + 'i' + ending;  //e.g. bliskiego
    }else{
        result = stem + ending;
    }
    return result;
}

Adjective.prototype.genitivePluralForGender = function (gender) {
    var stem = this.stem();
    var masculineEnding = this.masculineEnding(); // "i" or "y"
    var endings = this.adjectiveEndings['genitive-p'];
    var result = '';
    switch(gender) {
        case 'f': 
        case 'n':
        case 'm':
        case 'm-animate':
        case 'm-personal':
            result = stem + endings[0];
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result.replace(/i?\*/, masculineEnding);
};

Adjective.prototype.stem = function (){
    return this.f.replace(/a$/, '');
};
Adjective.prototype.masculineEnding = function(){
    return this.m.substr( this.m.length -1 );
};
Adjective.prototype.accusativeSingularForGender = function (gender){
    var stem = this.stem();
    // for e.g. niskie ryby, should move this logit into the stem method?
    //       k and g go to k′ and g′ before endings beginning with y or è: wielk-y:
    //       wielk′-y/i, spelled wielki; wielk-è: wielk′-e, spelled wielkie


    // F gets its own stem below so this is irrelevant for F
    if (gender !== 'f' && stem.match(/[kg]$/)){
        stem = stem + 'i';
    }
    var masculineEnding = this.masculineEnding(); // "i" or "y"
    var endings = this.adjectiveEndings['accusative-s'];
    var result = '';
    switch(gender) {
        case 'f': 
            // note we're re-assigning to stem
            stem = this.nominativeSingularForGender('f');
            stem = stem.replace(/a$/, '');
            result = stem + endings[2];
            break;
        case 'n':
            result = stem + endings[3];
            break;
        case 'm':
            result = this.m; // "=nom"
            break;
        case 'm-animate':
        case 'm-personal':
            if (stem.charAt(stem.length-1)=='k'){
                result = stem + 'i' + endings[0];  //e.g. bliskiego
            }else{
                result = stem + endings[0];
            }
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result.replace('*', masculineEnding);
};
Adjective.prototype.accusativePluralForGender = function (gender){
    var result = '';
    switch(gender) {
        case 'f': 
        case 'n':
        case 'm':
        case 'm-animate':
            result = this.nominativePluralForGender(gender);
            break;
        case 'm-personal':
            result = this.genitivePluralForGender(gender);
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result;
};
Adjective.prototype.wrapInTooltipDivs = function(str){
    return this.wrapInTooltipDivsTemplate({
        polishStr:      str,
        wikiLookup:     this.m,
        tooltipStr:     this.m+','+this.f+','+this.n
    });
} 

Adjective.prototype.makePolishStr = function(args){
    var caseMethodName     = args.caseMethodName; //e.g. "nominativeSingularForGender"
    var gender             = args.gender;
    var isInitialWord      = args.isInitialWord;
    var wrapInTooltipDivs  = args.wrapInTooltipDivs;

    var adjectiveStr = this[caseMethodName](gender);

    if (isInitialWord){
        adjectiveStr = adjectiveStr.charAt(0).toUpperCase() + adjectiveStr.slice(1);
    }
    if (wrapInTooltipDivs){
        adjectiveStr = this.wrapInTooltipDivs(adjectiveStr);
    }
    return adjectiveStr;
};


/**
 * @class Verb
 */
function Verb(args){
    this.infinitive    = args.infinitive;
    this.isTransitive  = args.transitive;
    this.subjectType   = args.ok_subjects;
    this.okObjects     = args.objects; //link?
    this.presentTense  = args.present_tense;
    this.pastTense     = args.past_tense;
    this.englishPast   = args.english_past;
    this.englishFuture = args.english_future;
    this.futureTense   = args.future_tense;

    this.wordId = args.infinitive[0]; // like a primary key for all the words here

    this.pinned        = false;
};
Y.extend(Verb, Word);

// This breaks down for pan/pani, since that's 3rd person
// but should read "you were running" since it's
// I think I need to keep track of the separate persons
// in english v. polish
Verb.prototype.getEnglishPast = function (number, person){
    // number is 'singular' or 'plural'
    // person is 1,2,3,
    if (number == 'singular' && (person == 1 || person == 3)){
        return this.englishPast; // was reading
    }else{
        return this.englishPast.replace('was', 'were');
    }
};

Verb.prototype.getPastTense = function(verbArgs){
    var str = '';

    verbStr = this.pastTense[ verbArgs.number ][ verbArgs.person - 1];
    //verbStr is now, e.g. 'brałem/brałam'
    var parts = verbStr.split('/');

    if (verbArgs.number === 's'){
        switch(verbArgs.gender){
            case 'm':
            case 'm-animate':
            case 'm-personal':
                verbStr = parts[0];
                break;
            case 'f':
                verbStr = parts[1];
                break;
            case 'n':
                // only 3rd pers sing has a neuter
                verbStr = parts[2]; 
                break;
            case undefined:
                // remaining pronouns, also taking the easy way out for now, 
                // default to masc.
                verbStr = parts[0];
                break;                    
            default:
                alert("I don't recognize this gender: " + verbArgs.gender);
                Y.log(verbArgs);
        }
    }else{
        switch(verbArgs.gender){
            case 'm-personal':
                verbStr = parts[0];
                break;
            default:
                verbStr = parts[1];
        }
    }
    return verbStr;
};
        

Verb.prototype.getFutureTense = function(verbArgs){
    var str = '';
    if (verbArgs.number === 's'){
        switch(verbArgs.gender){
            case 'm':
            case 'm-animate':
            case 'm-personal':
                str = this.futureTense['s'][0];
                break;
            case 'f':
                str = this.futureTense['s'][1];
                break;
            case 'n':
                str = this.futureTense['s'][1];
                str = str.replace(/ła$/, 'ło');
                break;
            default:
                alert("I don't know gender '" + verbArgs.gender + "'");
        }
        str = byćPast['s'][verbArgs.person-1] + ' ' + str;
    }else{
        switch(verbArgs.gender){
            case 'm-personal':
            case undefined: //pronouns, they must be personal
                str = this.futureTense['p'][0];
                break;
            default:
                str = this.futureTense['p'][1];
        }
        str = byćPast['p'][verbArgs.person-1] + ' ' + str;
    }

    return str;
};

Verb.prototype.wrapInTooltipDivs = function(str){

    return this.wrapInTooltipDivsTemplate({
        polishStr:  (str || ''),
        wikiLookup: this.infinitive[0],
        tooltipStr: this.infinitive[0] + ', ' + this.presentTense.s[0] + ', ' + this.presentTense.s[1]
    });
};
    

// this stuff should be in its own function so we can scope the variables
var tester = new Tester();
var i, row, noun, pronoun, adjective, verb;
for (i in nounData){
    row = nounData[i];
    noun = new Noun(row);
    tester.addNoun(noun);
}
for (i in pronounData){
    row = pronounData[i];
    pronoun = new Pronoun(row);
    tester.pronouns.push(pronoun);
}

for (i in adjectiveData){
    row = adjectiveData[i];
    adjective = new Adjective(row);
    tester.adjectives.push(adjective);
}

for (i in verbData){
    row = verbData[i];
    verb = new Verb(row);
    tester.addVerb(verb);
}

Y.on("domready", function() { 
    // need to setup the checkboxes before we can generate the question
    tester.populateCheckboxWordLists();
    tester.askQuestion(); 
});

var returnPressed = 'down:13';
Y.on('key', function(e) {
    tester.checkAnswer();
}, '#input', returnPressed, Y);

Y.on('click', function(e){
    tester.giveHint();
   }, '#give-hint', Y
);
Y.on('click', function(e){
    tester.askQuestion();
    }, '#go-again', Y
);
Y.on('click', function(e){
    tester.showAnswer();
    }, '#show-answer', Y
);
Y.on('click', function(e){
    tester.showHideWordList(e.currentTarget);
    }, '.buttony-legend-input', Y
);

// delegating to the outer element since the inner ones come and go with each question
Y.delegate('click', function(e){
    tester.pushpinPushed(e.currentTarget);
    }, '#question', ".pushpin",  Y
);

});


</script>

<style>
body {
    background: white;
}

.outer-box {
    border: 1px solid red; 
    margin: 50px; 
    padding: 50px;
    height: 600px;
    width: 900px;
}

.left-box div {
    padding: 10px;
}
.left-box {
    float: left;
    font-size: 200%;
    width: 65%;
}
.test-box {
    border: 1px solid black;
}


.graydot {
    color: lightgrey;
    padding: 4px;
}

.instructions {
    color: grey;
    font-size: 50%;
}

.settings-box {
    border: 1px solid yellow;
    float: right;
    width: 30%;
}

.input {
    margin: 0px;
    padding: 0px;
}
.input label {
    margin: 0px;
    padding: 0px;
}
.input label.radiobuttons {
    font-size: 75%;
}
input {
    font-size: 75%;
}
radio {
    margin: 0px;
    padding: 0px;

}

.answer-word {
    position: relative; /* //http://psacake.com/web/jl.asp */
    z-index: 24;
    text-decoration: none;
    color: #000;
}
.answer-word:hover {
    z-index: 25;
}
.tooltip {
    display: none;
    padding: 5px 10px 5px 10px;
}
.answer-word:hover .tooltip {
    display: block;
    position: absolute;
    font-size: 50%;
    border:1px solid #0cf;
    background-color: lightgray; 
    white-space: nowrap;
    top:2em; left:2em;  /* these two are required, not sure why */
}

.question-word:hover .pushpin {
    display: inline;
}


.pushpin {
    /* display: block; */

}

.pushpin-hidden {
    display: none;
}

.buttony-legend .buttony-legend-input {
    display: none;
}
.buttony-legend .buttony-legend-text {
    display: inline;
}
.buttony-legend:hover .buttony-legend-input {
    display: inline;
}
.buttony-legend:hover .buttony-legend-text {
    display: none;
}

/* the initially hidden list of vocabulary word checkboxes */
.section-word-list {
    overflow: auto; 
    height: 5em; 
    width: 80%; 
    border: 1px solid gray;
}

.hidden {
    display: none;
}

.answer-history {
	overflow: auto;
	height: 7em;
	/* width:80%;  */
	border: 1px solid green;
	font-size: 50%;
	padding: 10px;
    margin-top: 10px;
}
.answer-history div {
    margin: 1px;
    padding: 1px;
    color: grey;
}


</style>
</head>
<body>

<div class="outer-box">
    <div class="left-box">
        <div class="test-box">
            <div id="question">
            </div>
            <div id="input">
                <input type="text" size="36" id="input-element">
            </div>
            <div id="output">
            </div>
            <div id="result">
            </div>
            <div class="buttons">
                <button id="give-hint">Give me a hint?</button>
                <button id="show-answer">Tell me the answer</button>
                <br/>
                <button id="go-again">Another test</button>
            </div>
            <div class="instructions">
                <p>Type your answer in the box and press 'enter'.</p>
                <p>Mouse-over the words in the <strong>question</strong> to pin particular words you want to focus on.</p>
                <p>Mouse-over the words in the <strong>answer</strong> for additional details and a link to Wiktionary.org.</p>
    
            </div>
        </div>
        <div class="answer-history">

        </div>
    </div> <!-- end left box container -->
    <div class="settings-box">
        <form name="settings">
            <fieldset>
                <legend>Gender of Speaker:</legend>
                <div class="input">
                    <label><input type="radio" name="gender-of-speaker" value="m-personal" checked="1"/>Male</label>
                    <label><input type="radio" name="gender-of-speaker" value="f"            />Female</label>
                </div>
            </fieldset>
            <fieldset class="buttony-legend-XXXDisabledForNow">
                <legend>
                    <span class="buttony-legend-input-XXXDisabledForNow hidden" id="subject-section"><input type="button" value="Subjects"/></span><span class="buttony-legend-text">Subjects:</span>
                </legend>
                <div id="subject-section-list" class="input hidden section-word-list">
                    <!-- populated by populateCheckboxWordLists on documentLoad -->
                </div>
                    
                <div class="input">
                    <label><input type="checkbox" name="subject-singular" checked="1"/>Include singular subjects</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="subject-plural" checked="1"/>Include plural subjects</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="subject-pronouns" checked="1"/>Include pronoun subjects</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="subject-adjectives"/>Attach adjectives to subjects</label>
                </div>
            </fieldset>
            <fieldset>
                <!-- this should be grayed out if the only option is pronoun subjects -->
                <legend>Direct Objects</legend>
                <div class="input">
                    <label><input type="checkbox" name="object-adjectives" checked="1">Attach adjectives to the direct object</label>
                </div>
            <!-- could add "include verbs whose d/o takes the genitive (e.g. chcieć) -->
            </fieldset>
            <fieldset class="buttony-legend">
                <legend>
                    <span class="buttony-legend-input" id="verb-section"> <input type="button" value="Verbs"/></span><span class="buttony-legend-text">Verbs</span>
                </legend>
                <div id="verb-section-list" class="input hidden section-word-list" >
                    <!-- populated by populateCheckboxWordLists on documentLoad -->
                </div>
                <div class="input">
                    <label><input type="checkbox" name="verbs-present" checked="1"/>Include present tense</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="verbs-past" checked="1"/>Include past tense</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="verbs-future" checked="1"/>Include future tense</label>
                </div>
                <div class="input">
                    Include negations:<br>
                    <label class="radiobuttons"><input type="radio" name="verbs-negation" value="sometimes" checked="1"/>sometimes</label>
                    <label class="radiobuttons"><input type="radio" name="verbs-negation" value="always"/>always</label>
                    <label class="radiobuttons"><input type="radio" name="verbs-negation" value="never"/>never</label>
                </div>
            </fieldset>
        </form>
	</div>
</div>


</body>
</html>
