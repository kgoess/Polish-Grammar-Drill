<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>polish adjective agreement: subject-verb-object</title>

<script type="text/javascript" src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"></script>

<script type="text/javascript">

/* TODO:
   Będziemy lubili taniich ojców. fix that taniich to tanich
   Support pronouns as direct objects
   Allow multiple subjects
*/

YUI().use('node', 'event-key', 'anim', 'substitute', function(Y) {

var adjectiveEndings = {
             //    m-p_+_a  m-inam    f      n
 // "nominative-s": [    ~y or i~     'a'    'e'
    "genitive-s":   [ 'ego',  'ego',  'ej', 'ego' ],
    "dative-s":     [ 'emu',  'emu',  'ej', 'emu' ],
    "accusative-s": [ 'ego',  '=nom', 'ą',  'e'   ],
            //      m-pers    m       f    n 
    "nominative-p": [ 'IRR',   '=nas', '=nas', '=nas'],
    "genitive-p":   [ '*ch',   '*ch',  '*ch',  '*ch'] ,
    "dative-p":     [ '*m',    '*m',   '*m',   '*m' ],
    "accusative-p": [ '=gen',  '=nom', '=nom', '=nom'  ]
};
    
var pronounData = [
 [ 1, 's', '',           'I', ''],
 [ 2, 's', '',           'you', ''],
 [ 3, 's', 'm',          'he', ''], //what about m-personal?
 [ 3, 's', 'f',          'she', ''],
 [ 3, 's', 'm-personal', 'you (formal, masc.)', 'pan'],
 [ 3, 's', 'f',          'you (formal, fem.)', 'pani'],
 [ 1, 'p', '',           'we'],
 [ 2, 'p', '',           'you all'],
 [ 3, 'p', '',           'they'   ]
 //[ 3, 'p',               'you all (formal, masc.)'],
 //[ 3, 'p',               'you all (formal, mixed.)'], ????
];
  

//http://en.wikibooks.org/wiki/Polish/Masculine_noun_declension
//http://en.wiktionary.org/wiki/chłopiec
var nounData = [
 [ 'house',      'houses',       'dom',      'domy',      'dom',      'domy',      'm',          'no-agent' ], 
 [ 'cat',        'cats',         'kot',      'koty',      'kota',     'koty',      'm-animate',  'agent' ], 
 [ 'table',      'tables',       'stół',     'stóły',     'stoł',     'stoły',     'm',          'no-agent'  ], 
 [ 'store',      'stores',       'sklep',    'sklepy',    'sklep',    'sklepy',    'm',          'no-agent' ], 
 [ 'church',     'churches',     'koscioł',  'koscioły',  'koscioł',  'koscioły',  'm',          'no-agent' ], 
 [ 'car',        'cars',         'samochód', 'samochody', 'samochód', 'samochody', 'm',          'no-agent' ], 
 [ 'bicycle',    'bicycles',     'rower',    'rowery',    'rower',    'rowery',    'm',          'no-agent' ],
 [ 'train',      'trains',       'pociąg',   'pociągi',   'pociąg',   'pociągi',   'm',          'no-agent' ],
 [ 'airplane',   'airplanes',    'samolot',  'samoloty',  'samolot',  'samoloty',  'm',          'no-agent' ], 
 [ 'clock',      'clocks',       'zegar',    'zegary',    'zegar',    'zegary',    'm',          'no-agent' ],
 [ 'watch',      'watches',      'zegarek',  'zegarki',   'zegarek',  'zegarki',   'm',          'no-agent' ],
 [ 'room',       'rooms',        'pokoj',    'pokoje',    'pokoj',    'pokoje',    'm',          'no-agent' ],
 [ 'boy',        'boys',         'chłopiec', 'chłopcy',   'chłopca',  'chłopców',  'm-personal', 'i-agent' ], 
 [ 'pen',        'pens',         'długopis', 'długopisy', 'długopis', 'długopisy', 'm',          'no-agent' ], 
 [ 'shoe',       'shoes',        'but',      'buty',      'but',      'buty',      'm',          'no-agent' ], 
 [ 'sandwich',   'sandwiches',   'kanapka',  'kanapki',   'kanapkę',  'kanapki',   'f',          'no-agent' ],
 [ 'toy',        'toys',         'zabawka',  'zabawki',   'zabawkę',  'zabawki',   'f',          'no-agent' ],
 [ 'bank',       'banks',        'bank',     'banki',     'bank',     'banki',     'm',          'no-agent' ], 
 [ 'ball',       'balls',        'piłka',    'piłki',     'pilkę',    'pilki',     'f',          'no-agent' ],
 [ 'key',        'keys',         'klucz',    'klucze',    'klucz',    'klucze',    'm',          'no-agent' ], 
 [ 'plate',      'plates',       'talerz',   'talerze',   'talerz',   'talerze',   'm',          'no-agent' ], 
 [ 'hat',        'hats',         'kapelusz', 'kapelusze', 'kapelusz', 'kapelusze', 'm',          'no-agent' ], 
 [ 'horse',      'horses',       'koń',      'konie',     'konia',    'konie',     'm-animate',  'agent' ], 
 [ 'woman',      'women',        'kobieta',  'kobiety',   'kobietę',  'kobiety',   'f',          'i-agent' ], 
 [ 'school',     'schools',      'skoła',    'skoły',     'skolę',    'skoły',     'f',          'no-agent' ], 
 [ 'sister',     'sisters',      'siostra',  'siostry',   'siostrę',  'siostry',   'f',          'i-agent' ], 
 [ 'wife',       'wives',        'żona',     'żony',      'żonę',     'żony',      'f',          'i-agent' ], 
 [ 'cloud',      'clouds',       'chmura',   'chmury',    'chmurę',   'chmury',    'f',          'no-agent' ], 
 [ 'fish',       'fishes',       'ryba',     'ryby',      'rybę',     'ryby',      'f',          'agent' ], 
 [ 'bench',      'benches',      'ławka',    'ławki',     'ławkę',    'ławki',     'f',          'no-agent' ], 
 [ 'book',       'books',        'książka',  'książki',   'książkę',  'książki',   'f',          'no-agent' ], 
 [ 'daughter',   'daughters',    'córka',    'córki',     'córkę',    'córki',     'f',          'i-agent' ], 
 [ 't-shirt',    't-shirs',      'koszulka', 'koszulki',  'koszulkę', 'koszukli',  'f',          'no-agent' ], 
 [ 'skirt',      'skirts',       'spódnica', 'spódnice',  'spódnicę', 'spodnice',  'f',          'no-agent' ], 
 [ 'street',     'streets',      'ulica',    'ulice',     'ulica',    'ulice',     'f',          'no-agent' ], 
 [ 'road',       'roads',        'droga',    'drogi',     'drogę',    'drogi',     'f',          'no-agent' ], 
 [ 'apple',      'apples',       'jabłko',   'jabłka',    'jabłko',   'jabłka',    'n',          'no-agent' ], 
 [ 'chair',      'chairs',       'krzesło',  'krzesła',   'krzesło',  'krzesła',   'n',          'no-agent' ], 
 [ 'soap',       'soaps',        'mydło',    'mydła',     'mydło',    'mydła',     'n',          'no-agent' ], 
 [ 'bed',        'beds',         'łóżko',    'łóżka',     'łóżko',    'łóżka',     'n',          'no-agent' ], 
 [ 'animal',     'animals',      'zwierzę',  'zwierzęta', 'zwierzę',  'zwierzęta', 'n',          'agent' ],
 [ 'father',     'fathers',      'ojciec',   'ojcowie',   'ojca',     'ojców',     'm-personal', 'i-agent' ],
 [ 'husband',    'husbands',     'mąż',      'mężowie',   'męża',     'mężów',     'm-personal', 'i-agent' ],
 [ 'grandpa',    'grandpas',     'dziadek',  'dziadkowie','dziadka',  'dziadków',  'm-personal', 'i-agent' ],
 [ 'newspaper',  'newspapers',   'gazeta',   'gazety',    'gazetę',   'gazety',    'f',          'no-agent' ],
 [ 'letter',     'letters',      'list',     'listy',     'list',     'listy',     'm',          'no-agent' ],    
 [ 'dictionary', 'dictionaries', 'słownik',  'słowniki',  'słownik',  'słowniki',  'm',          'no-agent' ], 
 [ 'sign',       'sign',         'znak',     'znaki',     'znak',     'znaki',     'm',          'no-agent' ],
 [ 'egg',        'eggs',         'jajko',    'jajka',     'jajko',    'jajka',     'n',          'no-agent' ],
 [ 'carrot',     'carrots',      'marchew',  'marchwie',  'marchew',  'marchwie',  'f',          'no-agent' ],
 [ 'sausage',    'sausages',     'kiełbasa', 'kiełbasy',  'kiełbasę', 'kiełbasy',  'f',          'no-agent' ],
 [ 'cabbage',    'cabbages',     'kapusta',  'kapusty',   'kapustę',  'kapusty',   'f',          'no-agent' ]
] ;


var adjectiveData = [
  //           m             f             n           m-pers-plural
 [ 'large',  'duży',       'duża',       'duże',       'dużi'       ], 
 [ 'small',  'mały',       'mała',       'małe',       'małi'       ], 
 [ 'good',   'dobry',      'dobra',      'dobre',      'dobrzy'     ], 
 [ 'bad',    'zły',        'zła',        'złe',        'zli'        ], 
 [ 'tasty',  'smaczny',    'smaczna',    'smaczne',    'smaczni'    ], 
 [ 'nasty',  'niesmazcny', 'niesmaczna', 'niesmaczne', 'niesmaczni' ], 
 [ 'clean',  'czysty',     'czysta',     'czyste',     'czyści'     ], 
 [ 'wet',    'mokry',      'mokra',      'mokre',      'mokrzy'     ], 
 [ 'dry',    'suchy',      'sucha',      'suche',      'susi'       ], 
 [ 'dirty',  'brudny',     'brudna',     'brudne',     'brudni'     ], 
 [ 'sick',   'chory',      'chora',      'chore',      'chorzy'     ], 
 [ 'tired',  'zmęczony',   'zmęczona',   'zmęczone',   'zmęczeni'   ], 
 [ 'hot',    'gorący',     'gorąca',     'gorące',     'gorący'     ], 
 [ 'cold',   'zimny',      'zimna',      'zimne',      'zimni'      ], 
 [ 'white',  'biały',      'biała',      'białe',      'biali'      ], 
 [ 'black',  'czarny',     'czarna',     'czarne',     'czarni'     ], 
 [ 'red',    'czerwony',   'czerwona',   'czerwone',   'czerwoni'   ], 
 [ 'yellow', 'zółty',      'zółta',      'zółte',      'żółci'      ], 
 [ 'blue',   'niebieski',  'niebieska',  'niebieskie', 'niebiescy'  ], 
 [ 'green',  'zielony',    'zielona',    'zielone',    'zieleni'    ],
 [ 'gray',   'szary',      'szara',      'szare',      'szarzy'     ],
 [ 'brown',  'brązowy',    'brązowa',    'brązowe',    'brązowi'    ],
 [ 'pink',   'różowy',     'różowa',     'różowe',     'różowi'     ],
 [ 'tall',   'wysoki',     'wysoka',     'wysokie',    'wysocy'     ], 
 [ 'long',   'długi',      'długa',      'długie',     'dłudzy'     ], 
 [ 'distant','daleki',     'daleka',     'dalekie',    'dalecy'     ], 
 [ 'near',   'bliski',     'bliska',     'bliskie',    'bliscy'     ], 
 [ 'fast',   'szybki',     'szybka',     'szybkie',    'szybcy'     ],
 [ 'new',    'nowy',       'nowa',       'nowe',       'nowi'       ],
 [ 'old',    'stary',      'stara',      'stare',      'starzy'     ],
 [ 'polish', 'polski',     'polksa',     'polskie',    'polscy'     ], 
 [ 'short(low)', 'niski',  'niska',      'niskie',     'niscy'      ], 
 [ 'expensive', 'drogi',   'droga',      'drogie',     'drodzy'     ], 
 [ 'cheap',     'tani',    'tania',      'tanie',      'tani'       ]

// [ 'short(hair)', 'krótki', 'krótka', 'krótkie' ], 
 //[ 'heavy', 'ci
 //light lekka ...
 //powolne
];

var byćPast = {
    s: [ 'będę',     'będziesz',  'będzie' ],
    p: [ 'będziemy', 'będziecie', 'będą' ]
};

var verbData = [
    { infinitive: [ 'czytać', "to read" ],
      english_past: 'was reading',
      english_future: 'will be reading',
      transitive: true,
      ok_subjects: 'i-agent',
      objects: [ 'książka', 'gazeta', 'list', 'słownik', 'znak' 
      ],
      present_tense: {
        s: [ 'czytam', 'czytasz', 'czyta' ],
        p: [ 'czytamy', 'czytacie', 'czytają' ]
      },
      past_tense: {
        s: [ 'czytałem/czytałam', 'czytałeś/czytałaś', 'czytał/czytała/czytało' ],
        p: [ 'czytaliśmy/czytałyśmy', 'czytaliście/czytałyście', 'czytali/czytały' ]
      },
      future_tense: {
        s: [ 'czytał', 'czytała' ],
        p: [ 'czytali', 'czytały']
      }
    },

    { infinitive: [ 'jeść', "to eat" ],
      english_past: 'was eating',
      english_future: 'will be eating',
      transitive: true,
      ok_subjects: 'agent',
      objects: [ 'kanapka', 'jabłko', 'jajko', 'kiełbasa', 'marchew', 'kapusta' 
      ],
      present_tense: {
        s: [ 'jem', 'jesz', 'je' ],
        p: [ 'jemy', 'jecie', 'jedzą' ]
      },
      past_tense: {
        s: [ 'jadłem/jadłam', 'jadłeś/jadłaś', 'jadł/jadła/jadło' ],
        p: [ 'jedliśmy/jadłyśmy', 'jedliście/jadłysćie', 'jedli/jadły' ]
      }, 
      future_tense: {
        s: [ 'jadł', 'jadła'  ],
        p: [ 'jedli', 'jadły' ]
      }
    },

    { infinitive: [ 'lubić', 'to like' ],
      english_past: 'was liking',
      english_future: 'will be liking',
      transitive: true,
      ok_subjects: 'agent',
      objects: 'any',
      present_tense: {
        s: [ 'lubię', 'lubisz', 'lubi' ],
        p: [ 'lubimy', 'lubicie', 'lubią']
      },
      past_tense: {
        s: [ 'lubiłem/lubiłam', 'lubiłeś/lubiłaś', 'lubił/lubiła/lubiło' ],
        p: [ 'lubiliśmy/lubiłyśmy', 'lubiliście/lubiłyście', 'lubili/lubiły' ]
      },
      future_tense: {
        s: [ 'lubił', 'lubiła'  ],
        p: [ 'lubili', 'lubiły' ]
      }
    },
// apparently chcieć takes the genitive 
// http://www.polishforums.com/grammar-usage-18/adjective-endings-masculine-personal-51432/
//    { infinitive: [ 'chcieć', 'to want' ],
//      transitive: true,
//      ok_subjects: 'i-agent',
//      objects: 'any', 
//      present_tense: {
//        s: [ 'chcę', 'chcesz', 'chce' ],
//        p: [ 'chcemy', 'chcecie', 'chcą' ]
//      }
//    },

    { infinitive: ['biec', 'to run' ],
        english_past: 'was running',
        english_future: 'will be running',
       //http://en.wiktionary.org/wiki/biec see also http://en.wiktionary.org/wiki/biegać
       //The difference in the meaning is that biegać implies a repeated action whereas biec only a single/permanent one.
      transitive: false,
      ok_subjects: 'agent',
      present_tense: {
        s: [ 'biegnę', 'biegniesz', 'biegnie' ],
        p: [ 'biegniemy', 'biegniecie', 'biegną' ]
      },
      past_tense: {
        s: [ 'biegłem/biegłam', 'biegłeś/biegłaś', 'biegł/biegła/biegło' ],
        p: [ 'biegliśmy/biegłyśmy', 'biegliście/biegłyście', 'biegli/biegły' ]
      },
        
      future_tense: {
        s: [ 'biegł', 'biegła'  ],
        p: [ 'biegli', 'biegły' ]
      }
    },
    { infinitive: ['brać', 'to take' ],
      english_past: 'was taking',
      english_future: 'will be taking',
      transitive: true,
      ok_subjects: 'i-agent',
      objects: 'any',
      present_tense: {
        s: ['biorę', 'bierzesz', 'bierze' ],
        p: ['bierzemy', 'bierzecie', 'biorą' ]
      },
      past_tense: {
        s: [ 'brałem/brałam', 'brałeś/brałaś', 'brał/brała/brało' ],
        p: [ 'braliśmy/brałyśmy', 'braliście/brałyście', 'brali/brały' ]
      },
      future_tense: {
        s: [ 'brał', 'brała'  ],
        p: [ 'brali', 'brały' ]
      }
    } 
];


function Tester(){
    this.nouns = [];
    this.pronouns = [];
    this.adjectives = [];
    this.verbs = [];
    this.agents = [];
    this.intelligentAgents = [];
    this.nounLookup = {};
    this.currentVerb  = null;
    this.currentTense = null;
    this.currentPerson = null;
    this.currentSubject = null;
    this.currentObject = null;
}

Tester.prototype.addNoun = function(noun){
    this.nouns.push(noun);
    var type = noun.agentType;  // agent, i-agent, no-agent
    if (type === "agent"){
        this.agents.push(noun);
    }else if (type === "i-agent"){
        this.intelligentAgents.push(noun);
    }
    this.nounLookup[ noun.nom_sing ] = noun;
};
Tester.prototype.addVerb = function(verb){
    this.verbs.push(verb);
};

Tester.prototype.askQuestion = function(){
    var verb = this.verbs [ Math.floor(Math.random()*this.verbs.length) ];
    this.currentVerb = verb;

    var okSubjectType = verb.subjectType;
    var okSubjects;
    if (okSubjectType === 'i-agent'){
        okSubjects = this.intelligentAgents; 
    }else{
        okSubjects = this.agents;
    }
    if (this.doUsePronounSubject()){
        var pronoun = this.pronouns[ Math.floor(Math.random()*this.pronouns.length) ];
        this.currentSubject = pronoun;
        this.subjectNumber = pronoun.number === 's' ? 'singular' : 'plural';
        this.currentPerson = pronoun.person;
        this.subjectAdjective = false;
    }else{ //generateSubjectNumber will revert to 'singular' if nothing is checked
        this.subjectNumber = this.generateSubjectNumber();
        this.currentPerson = 3;
        this.currentSubject   = okSubjects[      Math.floor(Math.random()*okSubjects.length) ];
        this.subjectAdjective = this.generateSubjectAdjective();
    }

    if (verb.isTransitive){
        var okObjects = verb.okObjects;
        if (okObjects === 'any'){
            this.currentObject = this.nouns[ Math.floor( Math.random()*this.nouns.length ) ];
        }else{
            var okObjectKey = okObjects[ Math.floor( Math.random()*okObjects.length ) ];
            this.currentObject = this.nounLookup[ okObjectKey ];
            if (! this.currentObject){
                alert("couldn't find noun for '" + okObjectKey + "'");
            }
        }
        this.objectAdjective = this.generateObjectAdjective();
        this.objectNumber    = Math.floor( Math.random()*(2) +1 ) % 2 === 0 ? 'singular' : 'plural';
    }else{
        this.currentObject = null;
        this.objectAdjective = null;
        this.objectNumber = null;
    }

    this.currentTense = this.pickTense();

    
    var questionDiv = Y.one('#question');
    questionDiv.set('innerHTML', this.currentEnglishSentence());

    var outputDiv = Y.one('#output');
    outputDiv.set('innerHTML', '');

    var inputEl = Y.one('#input input');
    inputEl.focus();
    inputEl.set('value', '');

};

Tester.prototype.canUseRegularSubject = function(){
    var singularOk = document.settings["subject-singular"].checked;
    var pluralOk   = document.settings["subject-plural"].checked;

    return singularOk || pluralOk;
};


Tester.prototype.generateSubjectNumber = function(){
    var singularOk = document.settings["subject-singular"].checked;
    var pluralOk   = document.settings["subject-plural"].checked;

    if (singularOk && pluralOk){ 
        return Math.floor( Math.random()*(2) +1 ) % 2 === 0 ? 'singular' : 'plural';
    }else if (pluralOk){
        return 'plural';
    }else if (singularOk){
        return 'singular';
    }else{
        document.settings["subject-singular"].checked = 1;
        return 'singular';
    }
};

Tester.prototype.generateSubjectAdjective = function(){
    var subjectAdjectivesOk = document.settings["subject-adjectives"].checked;
    if (subjectAdjectivesOk){
        return this.adjectives[ Math.floor(Math.random()*this.adjectives.length) ];
    }else{
        return null;
    }
};

Tester.prototype.generateObjectAdjective = function(){
   var objectAdjectivesOk = document.settings["object-adjectives"].checked;
    if (objectAdjectivesOk){
        return this.adjectives[ Math.floor(Math.random()*this.adjectives.length) ];
    }else{
        return null;
    }
};

Tester.prototype.doUsePronounSubject = function(){
    var pronounsOk = document.settings["subject-pronouns"].checked;
    if (pronounsOk){
        if (this.canUseRegularSubject()){
            return Math.floor(Math.random()*3) % 3 === 0;
        }else{
            return true;
        }
    }else{
        return false;
    }
};

Tester.prototype.checkAnswer = function(){
    var answer = Y.one('#input input').get('value');
    answer = answer.replace(/ +$/, '');
    answer = answer.replace(/^ +/, '');


    if (answer === this.currentPolishSentence({wrapInTooltipDivs: false})){
        Y.one('#output').set('innerHTML', this.currentPolishSentence({wrapInTooltipDivs: true}));
        Y.one('#input-element').setStyle("background-color", "#3CFF00");
        
        alert('Doskonale!');

        var anim = new Y.Anim(
            { node: '#input-element', 
              from: { backgroundColor: "#3CFF00" },
              to:  { backgroundColor:  "#FFFFFF" }
            } 
        ); 
        anim.run();
    }else if (answer.charAt(0).toUpperCase() !== answer.charAt(0)){
        alert('Capitalzation is important...');
    }else if (answer.charAt( answer.length-1 ) !== '.'){
        alert('Punctuation is important...');
    }else{
        alert('Nie, zła odpowiedź, spróbuj ponownie!');
        //alert(this.currentPolishSentence({wrapInTooltipDivs: false}));
    }
};

Tester.prototype.currentPolishSentence = function(args){
    var wrapInTooltipDivs = args.wrapInTooltipDivs;  //true/false

    var subject = this.currentSubject;
    var subjectAdjective = this.subjectAdjective;
    var tense = this.currentTense; //present, past, future, etc...
    var verbArgs = {
        tense:             this.currentTense, //present, past, future, etc...
        number:            null,   // s or p
        person:            this.currentPerson, //1, 2, 3
        gender:            this.currentSubject.getGender(),
        wrapInTooltipDivs: wrapInTooltipDivs
    };
    var subjectStr, subjectAdjectiveStr, verbStr;
    if (this.subjectNumber === 'singular'){
        subjectStr = subject.makePolishStr({
            wrapInTooltipDivs: wrapInTooltipDivs,
            caseAccessor:      "nom_sing",
            isInitialWord:     (! subjectAdjective)
        });

        verbArgs.number = 's';
        verbArgs.isInitialWord = (! subjectStr);
        verbStr = this.currentPolishVerbStr(verbArgs);

        if (subjectAdjective){
            subjectAdjectiveStr = subjectAdjective.makePolishStr({
                caseMethodName:    "nominativeSingularForGender", 
                gender:            subject.getGender(),
                isInitialWord:     true,
                wrapInTooltipDivs: wrapInTooltipDivs
            }) + ' ';
        }else{
            subjectAdjectiveStr = '';
        }
        if (! subjectAdjectiveStr && ! subjectStr){
            verbStr = verbStr.charAt(0).toUpperCase() + verbStr.slice(1);
        }
        	

    }else{
        subjectStr = subject.makePolishStr({
            wrapInTooltipDivs: wrapInTooltipDivs,
            caseAccessor:      "nom_pl",
            isInitialWord:     (! subjectAdjective)
        });

        verbArgs.number = 'p';
        verbArgs.isInitialWord = (! subjectStr);
        verbStr = this.currentPolishVerbStr(verbArgs);

        if (subjectAdjective){
            subjectAdjectiveStr =  subjectAdjective.makePolishStr({
                caseMethodName:    "nominativePluralForGender", 
                gender:            subject.getGender(),
                isInitialWord:     true,
                wrapInTooltipDivs: wrapInTooltipDivs
            }) + ' ';
        }else{
            subjectAdjectiveStr = '';
        }
    }

    var str = subjectAdjectiveStr + subjectStr + ' ' + verbStr;
    str = str.replace(/^ +/, '');


    if (this.currentObject){
        var object = this.currentObject;
        var objectAdjective = this.objectAdjective;
        var objectStr, objectAdjectiveStr;
        if (this.objectNumber === 'singular'){
            objectStr = object.makePolishStr({
                wrapInTooltipDivs: wrapInTooltipDivs,
                caseAccessor:      "acc_sing"
            });
            if (objectAdjective){
                objectAdjectiveStr =  objectAdjective.makePolishStr({
                    caseMethodName:    "accusativeSingularForGender", 
                    gender:            object.getGender(),
                    isInitialWord:     false,
                    wrapInTooltipDivs: wrapInTooltipDivs
                });
            }else{
                objectAdjectiveStr = '';
            }
        }else{
            objectStr = object.makePolishStr({
                wrapInTooltipDivs: wrapInTooltipDivs,
                caseAccessor:      "acc_pl"
            });
            if (objectAdjective){
                objectAdjectiveStr =  objectAdjective.makePolishStr({
                    caseMethodName:    "accusativePluralForGender", 
                    gender:            object.getGender(),
                    isInitialWord:     false,
                    wrapInTooltipDivs: wrapInTooltipDivs
                });
            }else{
                objectAdjectiveStr = '';
            }
        }
        if (objectAdjectiveStr){
            objectAdjectiveStr = ' ' + objectAdjectiveStr ;
        }
        str = str + objectAdjectiveStr +  ' ' + objectStr;
    }
    str = str.replace(/ +$/, '') + '.';

    return str;
};

Tester.prototype.currentPolishVerbStr = function (verbArgs){
    var verbStr = '';
    var verb = this.currentVerb;
    switch(verbArgs.tense) {
        case 'present': 
            verbStr =  verb.presentTense[ verbArgs.number ][ verbArgs.person - 1 ];
            break;
        case 'past':
            verbStr = verb.getPastTense(verbArgs);
            break;
        case 'future':
            verbStr = verb.getFutureTense(verbArgs);
            break;
    }
    if (verbArgs.isInitialWord){
	    verbStr = verbStr.charAt(0).toUpperCase() + verbStr.slice(1);
	}

    if (verbArgs.wrapInTooltipDivs){
    	verbStr = verb.wrapInTooltipDivs(verbStr);
    }
    return verbStr;
};

Tester.prototype.pickTense = function(){
    var roll = null;
    var presentTenseOk = document.settings["verbs-present"].checked;
    var pastTenseOk    = document.settings["verbs-past"].checked;
    var futureTenseOk  = document.settings["verbs-future"].checked;

    if (! (presentTenseOk || pastTenseOk || futureTenseOk)){
        document.settings["verbs-present"].checked = 1;
        presentTenseOk = true;
    }

    var okTenses = [];
    if (presentTenseOk){
        okTenses.push('present');
    }
    if (pastTenseOk){
        okTenses.push('past');
    }
    if (futureTenseOk){
        okTenses.push('future');
    }
    
    roll = Math.floor(Math.random()*okTenses.length);
    return okTenses [ roll ];
};

Tester.prototype.giveHint = function() {

    var str = this.currentPolishSentence({wrapInTooltipDivs: false});

    var showEvery = 3;

    var outstr = '';
    var i;
    for (i = 0; i < str.length; ++i){
        var rand = Math.floor(Math.random()*showEvery);
        if (str.charAt(i) === ' ' || str.charAt(i) === '.'){
            outstr = outstr + str.charAt(i);
        }else{
            outstr = outstr + (rand % showEvery === 1 ? str.charAt(i) : '<span class="graydot">.</span>');
        }
    }
    Y.one('#output').set('innerHTML', outstr);
};

Tester.prototype.showAnswer = function(){
    var str = this.currentPolishSentence({wrapInTooltipDivs: true});

    Y.one('#output').set('innerHTML', str);

};

Tester.prototype.showImagesIsChecked = function(){

    var tmpValue;
    Y.all('.radio-show-google-images').each(function(node) {
        if (node.get('checked')) tmpValue = node.get('value');
    });
    return tmpValue;
};
    
Tester.prototype.currentEnglishSentence = function(){
    var s = '';
    if (this.subjectAdjective){
        s = this.subjectAdjective.english + ' ';
    }
    if (this.subjectNumber === 'singular'){
        s = s + this.currentSubject.english_sing;
    }else{
        s = s + this.currentSubject.english_pl;
    }
    if (! this.currentSubject.constructor.toString().match(/Pronoun/)){
        s = 'The ' + s;
    }

    //s = s + ' + ' + this.currentVerb.infinitive[1] ;
    s = s + ' + ' + this.getEnglishVerb() ;

    if (this.currentObject){
        if (this.objectNumber === 'singular'){
            s = s + ' + the ' + this.getObjectAdjectiveEnglishStr() + ' ' + this.currentObject.english_sing + '.';
        }else{
            s = s + ' + the ' + this.getObjectAdjectiveEnglishStr() + ' ' + this.currentObject.english_pl + '.';
        }
    }
    s = s.charAt(0).toUpperCase() + s.slice(1);

    return s;
};

Tester.prototype.getEnglishVerb = function(){
    var englishVerbStr = '';
    switch (this.currentTense){
        case 'present':
            englishVerbStr = this.currentVerb.infinitive[1];
            break;
        case 'past':
            switch (this.subjectNumber){
                case 'singular':
                    englishVerbStr = this.currentVerb.getEnglishPast('singular', this.currentPerson);
                    break;
                case 'plural':
                    englishVerbStr = this.currentVerb.getEnglishPast('plural', this.currentPerson);
                    break;
                default:
                    alert("I don't know this subjectNumber " + this.subjectNumber + " for subject " + this.currentSubject);
            }
            break;
        case 'future':
            englishVerbStr = this.currentVerb.englishFuture;
            break;
        default:
            alert("I don't know this tense: " + this.currentTense);
    }
    return englishVerbStr;
};

Tester.prototype.getObjectAdjectiveEnglishStr = function(){
    if (this.objectAdjective){
        return this.objectAdjective.english;
    }else{
        return '';
    }

};

Tester.prototype.generateGoogleUrl = function() {
    var s = escape(this.currentEnglishSentence());

    return 'http://images.google.com/search?safe=on&tbm=isch&q=' + s;
};
 
// looking for :hover on span instead of a tag means IE6 isn't supported, oh well
var tooltipTemplate = '<span class="answer-word" id="answerWordPartOfSentenceId"><span class="pushpin pushpin-on"><img src="file:///Users/kevin/Desktop/push_pin-on.png"/></span>{polishStr}<span class="tooltip"><span class="pushpin"><img src="file:///Users/kevin/Desktop/push_pin-off.png"></span><a href="http://en.wiktionary.org/wiki/{wikiLookup}#Polish" target="_blank">{tooltipStr}</a></span></span> ';
// how can I make this like a constant?

// this is part of the prototype of each kind of word (Noun, Verb, etc.)--make it a superclass instead?
function wrapInTooltipDivsTemplate (args){
	var str              = args.polishStr;
	var wikiLookup       = args.wikiLookup;
	var tooltipStr       = args.tooltipStr;
    var partOfSentenceId = args.partOfSentenceId;

	var tooltipTemplate = this.tooltipTemplate;

    var stash = {
        polishStr: str,
        wikiLookup: wikiLookup,
        tooltipStr: tooltipStr,
        answerWordPartOfSentenceId: partOfSentenceId
    }

    return Y.substitute(tooltipTemplate, stash);
}



function Noun(args){
    this.english_sing= args[0];
    this.english_pl = args[1];
    this.nom_sing = args[2];
    this.nom_pl = args[3];
    this.acc_sing = args[4];
    this.acc_pl = args[5];
    this.gender = args[6];
    this.agentType = args[7];
}
Noun.prototype.wrapInTooltipDivsTemplate = wrapInTooltipDivsTemplate;
Noun.prototype.tooltipTemplate = tooltipTemplate;

Noun.prototype.getGender = function(){
    return this.gender;
}
Noun.prototype.wrapInTooltipDivs = function(str){

	return this.wrapInTooltipDivsTemplate({
        polishStr: str,
        wikiLookup: this.nom_sing,
        tooltipStr: this.nom_sing+' '+this.gender+'.',
        partOfSentenceId: 'subject'
    });
} 

Noun.prototype.makePolishStr = function(args){
    var wrapInTooltipDivs = args.wrapInTooltipDivs; //true/false
    var caseAccessor      = args.caseAccessor; //e.g. "nom_sing"
    var isInitialWord     = args.isInitialWord;

    var nounStr = this[caseAccessor];

    if (isInitialWord){
        nounStr = nounStr.charAt(0).toUpperCase() + nounStr.slice(1);
    }

    if (wrapInTooltipDivs){
        nounStr = this.wrapInTooltipDivs(nounStr);
    }

    return nounStr;
}

function Pronoun(args){
    this.person = args[0];
    this.number = args[1];
    this.gender = args[2];
    this.english_sing= args[3];
    this.english_pl = args[3]; //cheating here so we can use both a noun and a pronoun, fix that
    this.nom_sing = args[4] || '';
    this.nom_pl = args[4] || '';
}
Pronoun.prototype.wrapInTooltipDivsTemplate = wrapInTooltipDivsTemplate;
Pronoun.prototype.tooltipTemplate = tooltipTemplate;

Pronoun.prototype.getGender = function(){
    var g = '';
    if ( this.person === 1 ){
        g = this.genderOfSpeaker();
    }else if ( this.person === 2 ){
        g = 'm-personal'; // do something better later
    }else if (this.gender){ // 3rd p singular
        g = this.gender;
    }else{
        g = 'm-personal';   // 3rd p plural, do something better later
    }
    return g;
}

Pronoun.prototype.genderOfSpeaker = function() {
    var nodeList =  document.settings["gender-of-speaker"];
    var i;
    for(i = 0; i < nodeList.length; i++) {
        if (nodeList.item(i).checked){
            g = nodeList.item(i).value;
        }
    }
    return g;
};

// we don't actually display the polish string for the pronouns, hmm, that's some side effect of something I think...?
Pronoun.prototype.wrapInTooltipDivs = function(str){
    return str;
}
Pronoun.prototype.makePolishStr = function(args){
    var caseMethodName     = args.caseMethodName; //e.g. "nominativeSingularForGender"
    var gender             = args.gender;
    var isInitialWord      = args.isInitialWord;
    var wrapInTooltipDivs  = args.wrapInTooltipDivs;

    var wrapInTooltipDivs = args.wrapInTooltipDivs; //true/false
    var caseAccessor = args.caseAccessor; //e.g. "nom_sing"

    var nounStr = this[caseAccessor];

    if (isInitialWord){
        nounStr = nounStr.charAt(0).toUpperCase() + nounStr.slice(1);
    }

    if (wrapInTooltipDivs){ //this is a no-op for pronouns
        nounStr = this.wrapInTooltipDivs(nounStr);
    }

    return nounStr;
}

function Adjective(args){
    this.english   = args[0];
    this.m         = args[1];
    this.f         = args[2];
    this.n         = args[3];
    this.mPersMasc = args[4];
}
Adjective.prototype.wrapInTooltipDivsTemplate = wrapInTooltipDivsTemplate;
Adjective.prototype.tooltipTemplate = tooltipTemplate;

Adjective.prototype.adjectiveEndings = adjectiveEndings;
Adjective.prototype.nominativeSingularForGender = function (gender){
    switch(gender) {
        case 'f': 
            return this.f;
        case 'n':
            return this.n;
        case 'm':
        case 'm-animate':
        case 'm-personal':
            return this.m;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
};
Adjective.prototype.nominativePluralForGender = function (gender){

    var result = '';
    
    switch(gender) {
        case 'f': 
        case 'n':
        case 'm':
        case 'm-animate':
            result = this.n;
            break;
        case 'm-personal':
            result = this.mPersMasc;
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result;
};
Adjective.prototype.genitivePluralForGender = function (gender) {
    var stem = this.stem();
    var masculineEnding = this.masculineEnding(); // "i" or "y"
    var endings = this.adjectiveEndings['genitive-p'];
    var result = '';
    switch(gender) {
        case 'f': 
        case 'n':
        case 'm':
        case 'm-animate':
        case 'm-personal':
            result = stem + endings[0];
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result.replace('*', masculineEnding);
};

Adjective.prototype.stem = function (){
    return this.f.replace(/a$/, '');
};
Adjective.prototype.accusativeSingularForGender = function (gender){
    var stem = this.stem();
    var masculineEnding = this.masculineEnding(); // "i" or "y"
    var endings = this.adjectiveEndings['accusative-s'];
    var result = '';
    switch(gender) {
        case 'f': 
            result = stem + endings[2];
            break;
        case 'n':
            result = stem + endings[3];
            break;
        case 'm':
            result = this.m; // "=nom"
            break;
        case 'm-animate':
        case 'm-personal':
            if (stem.charAt(stem.length-1)=='k'){
                result = stem + 'i' + endings[0];  //e.g. bliskiego
            }else{
                result = stem + endings[0];
            }
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result.replace('*', masculineEnding);
};
Adjective.prototype.accusativePluralForGender = function (gender){
    var result = '';
    switch(gender) {
        case 'f': 
        case 'n':
        case 'm':
        case 'm-animate':
            result = this.nominativePluralForGender(gender);
            break;
        case 'm-personal':
            result = this.genitivePluralForGender(gender);
            break;
        default:
            alert("Hey, what gender is '" + gender + "' supposed to be?");
    }
    return result;
};
Adjective.prototype.masculineEnding = function(){
    return this.m.substr( this.m.length -1 );
};

Adjective.prototype.wrapInTooltipDivs = function(str){
	return this.wrapInTooltipDivsTemplate({
        polishStr: str,
        wikiLookup: this.m,
        tooltipStr: this.m+','+this.f+','+this.n
    });
} 

Adjective.prototype.makePolishStr = function(args){
    var caseMethodName     = args.caseMethodName; //e.g. "nominativeSingularForGender"
    var gender             = args.gender;
    var isInitialWord      = args.isInitialWord;
    var wrapInTooltipDivs  = args.wrapInTooltipDivs;

    var subjectAdjectiveStr = this[caseMethodName](gender);

    if (isInitialWord){
        subjectAdjectiveStr = subjectAdjectiveStr.charAt(0).toUpperCase() + subjectAdjectiveStr.slice(1);
    }
    if (wrapInTooltipDivs){
        subjectAdjectiveStr = this.wrapInTooltipDivs(subjectAdjectiveStr);
    }
    return subjectAdjectiveStr;
}

function Verb(args){
    this.infinitive    = args.infinitive;
    this.isTransitive  = args.transitive;
    this.subjectType   = args.ok_subjects;
    this.okObjects     = args.objects; //link?
    this.presentTense  = args.present_tense;
    this.pastTense     = args.past_tense;
    this.englishPast   = args.english_past;
    this.englishFuture = args.english_future;
    this.futureTense   = args.future_tense;
}
Verb.prototype.wrapInTooltipDivsTemplate = wrapInTooltipDivsTemplate;
Verb.prototype.tooltipTemplate = tooltipTemplate;

// This breaks down for pan/pani, since that's 3rd person
// but should read "you were running" since it's
// I think I need to keep track of the separate persons
// in english v. polish
Verb.prototype.getEnglishPast = function (number, person){
    // number is 'singular' or 'plural'
    // person is 1,2,3,
    if (number == 'singular' && (person == 1 || person == 3)){
        return this.englishPast; // was reading
    }else{
        return this.englishPast.replace('was', 'were');
    }
};

Verb.prototype.getPastTense = function(verbArgs){
    var str = '';

    verbStr = this.pastTense[ verbArgs.number ][ verbArgs.person - 1];
    //verbStr is now, e.g. 'brałem/brałam'
    var parts = verbStr.split('/');

    if (verbArgs.number === 's'){
        switch(verbArgs.gender){
            case 'm':
            case 'm-animate':
            case 'm-personal':
                verbStr = parts[0];
                break;
            case 'f':
                verbStr = parts[1];
                break;
            case 'n':
                // only 3rd pers sing has a neuter
                verbStr = parts[2]; 
                break;
            case undefined:
                // remaining pronouns, also taking the easy way out for now, 
                // default to masc.
                verbStr = parts[0];
                break;                    
            default:
                alert("I don't recognize this gender: " + verbArgs.gender);
                Y.log(verbArgs);
        }
    }else{
        switch(verbArgs.gender){
            case 'm-personal':
                verbStr = parts[0];
                break;
            default:
                verbStr = parts[1];
        }
    }
    return verbStr;
};
        

Verb.prototype.getFutureTense = function(verbArgs){
    var str = '';
    if (verbArgs.number === 's'){
        switch(verbArgs.gender){
            case 'm':
            case 'm-animate':
            case 'm-personal':
                str = this.futureTense['s'][0];
                break;
            case 'f':
                str = this.futureTense['s'][1];
                break;
            case 'n':
                str = this.futureTense['s'][1];
                str = str.replace('ła$', 'ło');
                break;
            default:
                alert("I don't know gender '" + verbArgs.gender + "'");
        }
        str = byćPast['s'][verbArgs.person-1] + ' ' + str;
    }else{
        switch(verbArgs.gender){
            case 'm-personal':
            case undefined: //pronouns, they must be personal
                str = this.futureTense['p'][0];
                break;
            default:
                str = this.futureTense['p'][1];
        }
        str = byćPast['p'][verbArgs.person-1] + ' ' + str;
    }

    return str;
};

Verb.prototype.wrapInTooltipDivs = function(str){

	return this.wrapInTooltipDivsTemplate({
		polishStr:  (str || ''),
		wikiLookup: this.infinitive[0],
		tooltipStr: this.infinitive[0] + ', ' + this.presentTense.s[0] + ', ' + this.presentTense.s[1]
	});
}
    

// this stuff should be in its own function so we can scope the variables
var tester = new Tester();
var i, row, noun, pronoun, adjective, verb;
for (i in nounData){
    row = nounData[i];
    noun = new Noun(row);
    tester.addNoun(noun);
}
for (i in pronounData){
    row = pronounData[i];
    pronoun = new Pronoun(row);
    tester.pronouns.push(pronoun);
}

for (i in adjectiveData){
    row = adjectiveData[i];
    adjective = new Adjective(row);
    tester.adjectives.push(adjective);
}

for (i in verbData){
    row = verbData[i];
    verb = new Verb(row);
    tester.addVerb(verb);
}

Y.on("domready", function() { tester.askQuestion(); });

var returnPressed = 'down:13';
Y.on('key', function(e) {
    tester.checkAnswer();
}, '#input', returnPressed, Y);

Y.on('click', function(e){
    tester.giveHint();
   }, '#give-hint', Y
);
Y.on('click', function(e){
    tester.askQuestion();
    }, '#go-again', Y
);
Y.on('click', function(e){
    tester.showAnswer();
    }, '#show-answer', Y
);
});


</script>

<style>
body {
    background: white;
}

.outer-box {
    border: 1px solid red; 
    margin: 50px; 
    padding: 50px;
    height: 500px;
    width: 900px;
}

.test-box div {
    padding: 10px;
}
.test-box {
    float: left;
    border: 1px solid black;
    font-size: 200%;
    width: 65%;
}


.graydot {
    color: lightgrey;
}

.instructions {
    color: grey;
    font-size: 50%;
}

.settings-box {
    border: 1px solid yellow;
    float: right;
    width: 30%;
}

.input {
    margin: 0px;
    padding: 0px;
}
.input label {
    margin: 0px;
    padding: 0px;
}
input {
    font-size: 75%;
}
radio {
    margin: 0px;
    padding: 0px;

}

.answer-word {
    position: relative; //http://psacake.com/web/jl.asp
    z-index: 24;
    text-decoration: none;
    color: #000;
}
.answer-word:hover {
    z-index: 25;
}
.tooltip {
    display: none;
    padding: 5px 10px 5px 10px;
}
.answer-word:hover .tooltip {
    display: block;
    position: absolute;
    font-size: 50%;
    border:1px solid #0cf;
    background-color: lightgray; 
    white-space: nowrap;
    top:2em; left:2em;  //these two are required, not sure why
}


.pushpin {
    //display: block;

}

.pushpin-on {
    display: none;
}


</style>
</head>
<body>

<div class="outer-box">
    <div class="test-box">
        <div id="question">
        </div>
        <div id="input">
            <input type="text" size="40" id="input-element">
        </div>
        <div id="output">
        </div>
        <div id="result">
        </div>
        <div class="buttons">
            <button id="give-hint">Give me a hint?</button>
            <button id="show-answer">Tell me the answer</button>
            <br/>
            <button id="go-again">Another test</button>
        </div>
        <div class="instructions">Type your answer in the box and press 'enter'.</div>
    </div>
    <div class="settings-box">
        <form name="settings">
            <fieldset>
                <legend>Gender of Speaker:</legend>
                <div class="input">
                    <label><input type="radio" name="gender-of-speaker" value="m-personal" checked="1"/>Male</label>
                    <label><input type="radio" name="gender-of-speaker" value="f"            />Female</label>
                </div>
            </fieldset>
            <fieldset>
                <legend>Subjects:</legend>
                <div class="input">
                    <label><input type="checkbox" name="subject-singular" checked="1"/>Include singular subjects</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="subject-plural" checked="1"/>Include plural subjects</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="subject-pronouns" checked="1"/>Include pronoun subjects</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="subject-adjectives" checked="1"/>Attach adjectives to subjects</label>
                </div>
            </fieldset>
            <fieldset>
                <!-- this should be grayed out if the only option is pronoun subjects -->
                <legend>Direct Objects</legend>
                <div class="input">
                    <label><input type="checkbox" name="object-adjectives" checked="1">Attach adjectives to the direct object</label>
                </div>
            <!-- could add "include verbs whose d/o takes the genitive (e.g. chcieć) -->
            </fieldset>
            <fieldset>
                <legend>Verbs</legend>
                <div class="input">
                    <label><input type="checkbox" name="verbs-present" checked="1"/>Include present tense</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="verbs-past" checked="1"/>Include past tense</label>
                </div>
                <div class="input">
                    <label><input type="checkbox" name="verbs-future" checked="1"/>Include future tense</label>
                </div>
            </fieldset>
        </form>
    <div>
</div>


</body>
</html>
